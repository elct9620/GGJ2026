# Game Specification: Night Market Defense

> 版本：0.1.0
> 最後更新：2026-01-31

# 1. Intent Layer

## 1.1 Purpose

本遊戲為 Global Game Jam 2026 參賽作品，主題為「Mask」。透過橫向類塔防遊戲機制，讓玩家體驗台灣夜市攤位文化與餓鬼傳說的結合。

**核心價值主張**：

- 快節奏的戰鬥與資源管理結合
- 台灣夜市特色食材合成系統
- 策略性的攤位防守與升級選擇

## 1.2 Users

**主要使用者**：

- 團隊成員和朋友
- Game Jam 評審和參與者
- 休閒遊戲玩家

**使用情境**：

- 單人遊戲體驗
- 瀏覽器環境（Cloudflare 部署）
- 短時間遊戲場次（5-15 分鐘）

## 1.3 Success Criteria

**可衡量指標**：

1. **完成度**：所有核心系統可運作
   - 攤位系統可儲存和提取食材
   - 戰鬥系統可射擊和擊敗敵人
   - 合成系統可產生特殊子彈
   - 升級系統可強化能力

2. **遊戲平衡**：
   - 玩家可存活至少 5 個回合
   - 進階玩家可達成 10 個回合以上
   - 每個回合有明確的挑戰增長

3. **主題符合度**：
   - 遊戲機制呼應「Mask」主題（覆蓋、防守）
   - 視覺和音效完整呈現

4. **技術品質**：
   - 在現代瀏覽器流暢運行（60 FPS）
   - 無重大錯誤和崩潰

**驗證方式**：參見 [Testing Specification](docs/testing.md) 的驗收測試（4.1 User Stories）和效能測試（5. Performance Tests）。

# 2. Design Layer

## 2.1 Game Overview

**核心概念**：玩家操作角色在夜市攤位區防守，透過射擊餓鬼、收集食材、合成特殊子彈，在無盡回合中盡可能存活。

**遊戲循環**：

1. 敵人從右側生成並向左移動
2. 玩家射擊敵人獲取食材
3. 收集食材到攤位儲存
4. 合成特殊子彈強化攻擊
5. 回合結束後選擇升級
6. 敵人數量增加，難度提升

## 2.2 Terminology

| 術語                  | 定義                                       |
| --------------------- | ------------------------------------------ |
| **Player（玩家）**    | 可操作的角色，能在遊戲畫面中自由移動       |
| **Booth（攤位）**     | 用來儲存食材的固定區域，每種食材有專屬攤位 |
| **Food（食材）**      | 合成技能的素材，擊敗敵人掉落，敵人也會奪取 |
| **Ghost（餓鬼）**     | 一般敵人，生命值 1 點                      |
| **Boss（餓死鬼）**    | 強化敵人，生命值 3 點，每 5 回合出現       |
| **Wave（回合）**      | 每回合生成固定數量敵人，回合數越高敵人越多 |
| **Bullet（子彈）**    | 玩家攻擊單位，包含普通子彈和特殊子彈       |
| **Synthesis（合成）** | 消耗 3 個食材產生特殊子彈效果              |
| **Upgrade（升級）**   | 回合間強化能力的永久效果                   |

## 2.3 Core Systems

### 2.3.1 Booth System

**Purpose**: 儲存食材供合成使用

**Constraints**:

- 固定 3 個攤位位置（遊戲開始時已設置）
- 每個攤位對應一種食材類型
- 每個攤位可儲存 6 個食材（6 slots）

**Behaviors**:

- **Auto-Collect（自動收集）**: 擊殺敵人時食材立即加入對應攤位（隨機類型：珍珠/豆腐/米血）
- **Retrieve（提取）**: 按下數字鍵 1/2/3 從對應攤位提取食材到合成槽
- **Enemy Steal（敵人奪取）**: 敵人觸碰攤位時偷取 1 個食材

**Error Scenarios**:

| 操作     | 當前狀態         | 結果               |
| -------- | ---------------- | ------------------ |
| 收集食材 | 攤位已滿（6/6）  | 食材無法收集並消失 |
| 提取食材 | 攤位為空（0/6）  | 無法提取           |
| 提取食材 | 合成槽已滿（3/3）| 無法提取           |

**Food Types**:

| 食材名稱 | 攤位編號 | 最大儲存量 |
| -------- | -------- | ---------- |
| 珍珠     | 1        | 6          |
| 豆腐     | 2        | 6          |
| 米血     | 3        | 6          |

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.1 Booth System Tests。

### 2.3.2 Combat System

**Purpose**: 玩家透過射擊擊敗敵人

**Constraints**:

- 彈夾容量：6 發子彈
- 重裝時間：3 秒
- 普通子彈傷害：1 點（擊殺 1 隻餓鬼）
- 特殊子彈持續時間：2 秒（夜市總匯除外）

**Behaviors**:

- **Normal Attack（普通攻擊）**:
  - 按下 Space 鍵發射子彈
  - 子彈向右直線飛行
  - 擊中敵人造成傷害
  - 消耗彈夾數量（6 → 5 → ... → 0）

- **Reload（重裝）**:
  - 彈夾歸零時自動觸發
  - 3 秒後彈夾恢復至 6 發
  - 重裝期間玩家可移動但無法射擊

- **Special Bullet（特殊子彈）**:
  - 合成成功後立即啟動 2 秒 Buff
  - Buff 期間發射的子彈擁有特殊效果
  - Buff 結束後恢復普通子彈
  - 不替換彈夾內容，只是臨時強化

**Error Scenarios**:

| 輸入       | 當前狀態          | 結果         |
| ---------- | ----------------- | ------------ |
| 按 Space   | 重裝期間          | 無反應       |
| 按 Space   | 彈夾為空（0/6）   | 無反應       |
| 按數字鍵   | 特殊 Buff 期間    | 無法再次合成 |

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.2 Combat System Tests。

### 2.3.3 Synthesis System

**Purpose**: 組合食材產生特殊子彈效果

**Constraints**:

- 合成槽容量：3 個食材
- 自動觸發：放入第 3 個食材時立即消耗並發動

**Behaviors**:

- **Insert Food（放入食材）**:
  - 按下數字鍵 1/2/3 從攤位提取食材
  - 食材進入合成槽（1/3 → 2/3 → 3/3）

- **Auto Synthesis（自動合成）**:
  - 放入第 3 個食材時立即觸發
  - 檢查合成配方表
  - 消耗 3 個食材
  - 啟動對應特殊子彈效果（2 秒 Buff）

- **Clear Slot（清空槽位）**:
  - 合成後槽位歸零（3/3 → 0/3）

**Error Scenarios**:

| 操作         | 當前狀態        | 結果                                             |
| ------------ | --------------- | ------------------------------------------------ |
| 放入食材     | 合成槽已滿（3/3）| 無法放入                                        |
| 合成觸發     | 不存在對應配方  | 理論上不會發生（所有組合都有配方）                |

**Synthesis Recipes**:

| 子彈名稱   | 配方                      | 效果                                              | 持續時間 |
| ---------- | ------------------------- | ------------------------------------------------- | -------- |
| 臭豆腐     | 豆腐 ×3                   | 2 倍大巨大子彈，基礎傷害 ×2                       | 2s       |
| 珍珠奶茶   | 珍珠 ×3                   | 散射 10 個小子彈                                  | 2s       |
| 豬血糕     | 米血 ×3                   | 穿透追蹤子彈，傷害 ×1.2                           | 2s       |
| 臭豆腐奶茶 | 豆腐 ×2、珍珠 ×1          | 散射 3 個 1.6 倍巨大子彈，基礎傷害 ×1.6           | 2s       |
| 珍珠臭豆腐 | 豆腐 ×1、珍珠 ×2          | 散射 6 個 1.2 倍巨大子彈，基礎傷害 ×1.2           | 2s       |
| 豬血糕奶茶 | 米血 ×2、珍珠 ×1          | 散射 3 個穿透追蹤小子彈，基礎傷害 ×1.2            | 2s       |
| 珍珠豬血糕 | 米血 ×1、珍珠 ×2          | 散射 6 個穿透追蹤小子彈                           | 2s       |
| 臭豬血糕   | 豆腐 ×2、米血 ×1          | 1.6 倍穿透追蹤巨大子彈，基礎傷害 ×1.8             | 2s       |
| 豬血糕豆腐 | 豆腐 ×1、米血 ×2          | 1.2 倍穿透追蹤巨大子彈，基礎傷害 ×2               | 2s       |
| 夜市總匯   | 豆腐 ×1、珍珠 ×1、米血 ×1 | 閃電連鎖追蹤，傷害 ×3，擊中敵人後連鎖至下一個敵人 | 2s       |

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.3 Synthesis System Tests。

### 2.3.4 Upgrade System

**Purpose**: 回合間永久強化玩家能力

**Constraints**:

- 每回合結束提供 2 個隨機選項
- 玩家選擇其中 1 個
- 升級效果永久持續（整場遊戲）
- 同一升級可重複選擇（效果堆疊）

**Behaviors**:

- **Present Options（呈現選項）**:
  - 回合結束觸發
  - 隨機抽取 2 個升級選項
  - 顯示升級效果和消耗

- **Apply Upgrade（套用升級）**:
  - 玩家選擇後消耗對應食材
  - 永久修改遊戲參數
  - 進入下一回合

**Error Scenarios**:

| 操作         | 條件           | 結果             |
| ------------ | -------------- | ---------------- |
| 選擇升級     | 食材不足       | 無法選擇該升級   |
| 進入下一回合 | 未選擇任何選項 | 無法進入下一回合 |

**Upgrade Options**:

| 升級名稱 | 效果                    | 消耗    |
| -------- | ----------------------- | ------- |
| 加辣     | 臭豆腐傷害倍率 +0.5     | 豆腐 ×3 |
| 加椰果   | 珍珠奶茶子彈數 +5       | 珍珠 ×3 |
| 加香菜   | 豬血糕傷害範圍倍率 +0.5 | 米血 ×3 |

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.4 Upgrade System Tests。

### 2.3.5 Wave System

**Purpose**: 控制敵人生成和回合進程

**Constraints**:

- 無限回合（直到玩家死亡）
- 敵人數量線性增長：回合數 × 2
- Boss 每 5 回合出現一次

**Behaviors**:

- **Spawn Enemies（生成敵人）**:
  - 回合開始時計算敵人數量
  - 一般敵人數 = 回合數 × 2
  - Boss 回合（5, 10, 15...）額外生成 1 隻 Boss

- **Wave Progression（回合進程）**:
  - 所有敵人被擊敗或到達底線
  - 觸發升級選擇
  - 升級完成後進入下一回合

**Error Scenarios**:

| 條件           | 結果                     |
| -------------- | ------------------------ |
| 玩家生命值歸零 | 遊戲結束，不進入下一回合 |

**Wave Formula**:

| 回合數 | 一般敵人數 | Boss 數 | 總敵人數 |
| ------ | ---------- | ------- | -------- |
| 1      | 2          | 0       | 2        |
| 2      | 4          | 0       | 4        |
| 3      | 6          | 0       | 6        |
| 4      | 8          | 0       | 8        |
| 5      | 10         | 1       | 11       |
| 10     | 20         | 1       | 21       |
| 15     | 30         | 1       | 31       |

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.5 Wave System Tests。

## 2.4 Player Interactions

### 2.4.1 Input Controls

**鍵盤操作**:

| 按鍵  | 功能     | 行為                         |
| ----- | -------- | ---------------------------- |
| W     | 向上移動 | 玩家向上移動（200 px/s）     |
| A     | 向左移動 | 玩家向左移動（200 px/s）     |
| S     | 向下移動 | 玩家向下移動（200 px/s）     |
| D     | 向右移動 | 玩家向右移動（200 px/s）     |
| Space | 射擊     | 發射子彈（消耗彈夾）         |
| 1     | 提取食材 | 從攤位 1（珍珠）提取到合成槽 |
| 2     | 提取食材 | 從攤位 2（豆腐）提取到合成槽 |
| 3     | 提取食材 | 從攤位 3（米血）提取到合成槽 |

**Error Scenarios**:

| 輸入       | 當前狀態         | 結果         |
| ---------- | ---------------- | ------------ |
| 按 Space   | 重裝期間         | 無反應       |
| 按數字鍵   | 攤位為空（0/6）  | 無反應       |
| 按數字鍵   | 合成槽已滿（3/3）| 無反應       |
| 移動鍵     | 超出遊戲邊界     | 停止移動     |

### 2.4.2 User Journey

**遊戲開始**:

1. 進入遊戲主畫面
2. 顯示 3 個空攤位（左側 20% 區域）
3. 玩家角色出現在中央
4. 第 1 回合開始（2 隻餓鬼生成）

**回合中**:

1. 敵人從右側畫面外生成
2. 玩家移動並射擊敵人
3. 擊敗敵人時食材立即儲存到對應攤位
4. 提取食材到合成槽
5. 放入第 3 個食材觸發合成
6. 特殊子彈效果啟動 2 秒
7. 重複 2-6 直到所有敵人清除

**回合結束**:

1. 顯示升級選項（2 選 1）
2. 玩家選擇升級
3. 消耗食材套用升級
4. 進入下一回合

**遊戲結束**:

1. 玩家生命值歸零
2. 顯示存活回合數
3. 顯示擊敗敵人總數
4. 選項：重新開始 / 結束遊戲

## 2.5 Game Entities

### 2.5.1 Player

**Properties**:

- 移動速度：200 px/s
- 碰撞箱：24×24 px（縮小碰撞，提高容錯率）
- 生命值：5 條（敵人到達底線扣 1 條）
- 彈夾容量：6 發
- 當前彈夾數：0-6

**Behaviors**:

- 接收鍵盤輸入移動
- 發射子彈
- 死亡條件：生命值歸零

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.6 Player Tests。

### 2.5.2 Enemies

**餓鬼（Ghost）**:

- 生命值：1 HP
- 移動速度：0.5 單位/秒（約 50 px/s）
- 傷害：到達底線扣玩家 1 條生命
- 食材掉落：100% 機率產生隨機食材（珍珠/豆腐/米血），立即加入對應攤位

**餓死鬼（Boss）**:

- 生命值：3 HP
- 移動速度：0.3 單位/秒（約 30 px/s）
- 傷害：到達底線扣玩家 1 條生命
- 食材掉落：100% 機率產生隨機食材（珍珠/豆腐/米血），立即加入對應攤位

**共同行為**:

- 從右側畫面外生成
- 向左移動
- 碰撞攤位時偷取 1 個食材（不改變移動方向）
- 到達底線（左側邊界）扣玩家生命並消失
- 被子彈擊中扣除生命值
- 生命值歸零時死亡，食材立即加入對應攤位

**測試案例**：參見 [Testing Specification](docs/testing.md) § 2.7 Enemy Tests。

### 2.5.3 Bullets

**普通子彈**:

- 傷害：1
- 速度：400 px/s（向右飛行）
- 穿透：否
- 散射：否

**特殊子彈屬性**:

| 屬性     | 說明                     | 範例           |
| -------- | ------------------------ | -------------- |
| 傷害倍率 | 基礎傷害 × 倍率          | 臭豆腐 ×2      |
| 大小倍率 | 碰撞箱放大               | 臭豆腐 2 倍大  |
| 散射數量 | 同時發射多個子彈         | 珍珠奶茶 10 個 |
| 穿透     | 擊中敵人不消失           | 豬血糕         |
| 追蹤     | 子彈自動追蹤敵人         | 豬血糕         |
| 連鎖     | 擊中後自動攻擊下一個敵人 | 夜市總匯       |

## 2.6 Visual Layout

### 2.6.1 Screen Resolution

- **目標解析度**：1920×1080 (Full HD)
- **寬高比**：16:9
- **視角**：2D 俯視角（Top-Down）

### 2.6.2 Main Scene Layout

**攤位區域（左側）**:

- 寬度：384 px（20% of 1920）
- 高度：1080 px（全高）
- 內容：3 個垂直排列的攤位

**活動區域（中央到右側）**:

- 寬度：1536 px（80% of 1920）
- 高度：1080 px（全高）
- 內容：玩家、敵人、子彈

**邊界定義**:

- 左邊界：x = 384（攤位區右側）
- 右邊界：x = 1920（畫面右側）
- 上邊界：y = 0
- 下邊界：y = 1080
- 底線：x = 384（敵人觸碰此線扣生命）

### 2.6.3 HUD Layout

**上方 HUD**:

- 位置：畫面頂部
- 高度：60 px
- 內容：
  - 當前回合數
  - 剩餘敵人數量
  - 玩家生命值（5 條）

**下方 HUD**:

- 位置：畫面底部
- 高度：120 px
- 內容：
  - 合成槽（3 個槽位，顯示已放入的食材）
  - 當前特殊子彈效果（Buff 圖示和剩餘時間）
  - 彈夾數量（6/6）

**重要約束**:

- HUD 不可遮蓋遊戲活動區域
- HUD 背景需半透明或完全獨立於遊戲畫面

## 2.7 Game States

### 2.7.1 Victory Condition

**不存在勝利條件**（無盡模式）

目標：盡可能存活更多回合

### 2.7.2 Defeat Condition

**觸發條件**:

- 玩家生命值歸零（5 → 4 → 3 → 2 → 1 → 0）

**扣血機制**:

- 敵人（餓鬼或 Boss）到達底線（x = 384）扣 1 條生命
- 敵人消失，玩家生命值 -1

**結束行為**:

1. 遊戲暫停
2. 顯示結算畫面：
   - 存活回合數
   - 擊敗敵人總數
   - 使用特殊子彈次數
3. 提供選項：重新開始 / 結束遊戲

# 3. Consistency Layer

## 3.1 Patterns

**資源流動模式**:

```
敵人死亡 → 食材立即儲存到攤位 → 提取到合成槽 → 消耗合成 → 特殊子彈
```

**時間驅動模式**:

- 彈夾重裝：3 秒固定時間
- 特殊 Buff：2 秒固定時間
- 敵人移動：持續性移動（速度固定）

**自動觸發模式**:

- 收集食材：擊殺敵人自動收集
- 合成：放入第 3 個食材自動觸發
- 重裝：彈夾歸零自動開始
- 回合進程：敵人清空自動進入升級

## 3.2 Forms

**數值格式**:

- 速度：px/s（像素/秒）
- 時間：s（秒）
- 傷害：整數倍率（×1, ×1.2, ×2...）
- 生命值：整數（1, 3, 5）
- 儲存量：整數/最大值（3/6）

**狀態格式**:

- 彈夾：當前數/最大數（3/6）
- 合成槽：已放入數/容量（2/3）
- 攤位：食材數/容量（4/6）
- 生命值：當前數/最大數（3/5）

## 3.3 Contracts

**碰撞檢測協議**:

- 玩家與敵人：無效果（玩家不受傷）
- 子彈與敵人：敵人扣血，生命值歸零時觸發食材收集
- 敵人與攤位：偷取 1 個食材
- 敵人與底線：扣玩家生命，敵人消失

**系統間通訊**:

- 戰鬥系統 → 合成系統：檢查當前 Buff 狀態
- 合成系統 → 攤位系統：提取食材請求
- 回合系統 → 升級系統：回合結束觸發
- 升級系統 → 戰鬥系統：永久修改參數

# 4. Technical Specifications

## 4.1 Technology Stack

**渲染引擎**:

- **Pixi.js v8.x**：2D WebGL 渲染引擎
- **用途**：場景渲染、精靈管理、動畫系統

**開發工具**:

- **TypeScript**：型別安全的程式語言
- **Vite**：建置工具和開發伺服器
- **Vitest**：單元測試框架

**部署平台**:

- **Cloudflare Pages**：靜態網站託管

## 4.2 Pixi.js Architecture

### 4.2.1 Application Setup

**Canvas 設定**:

```typescript
{
  width: 1920,
  height: 1080,
  backgroundColor: 0x1a1a1a,
  resolution: window.devicePixelRatio || 1,
  autoDensity: true,
  antialias: true
}
```

**目標幀率**：60 FPS（使用 Pixi.Ticker）

### 4.2.2 Scene Structure

**Container 階層**:

```
Application.stage
├── Background Layer (z-index: 0)
│   └── 攤位區域背景
├── Game Layer (z-index: 1)
│   ├── Booth Container
│   │   ├── Booth 1 (珍珠)
│   │   ├── Booth 2 (豆腐)
│   │   └── Booth 3 (米血)
│   ├── Player Sprite
│   ├── Enemies Container
│   │   ├── Ghost Sprites (動態生成)
│   │   └── Boss Sprites (動態生成)
│   └── Bullets Container
│       ├── Normal Bullets (動態生成)
│       └── Special Bullets (動態生成)
└── UI Layer (z-index: 2)
    ├── Top HUD Container
    │   ├── Wave Counter Text
    │   ├── Enemy Counter Text
    │   └── Health Display
    └── Bottom HUD Container
        ├── Synthesis Slot Container
        ├── Buff Display
        └── Ammo Counter Text
```

### 4.2.3 Sprite Management

**Texture 資源**:

- 使用 `Pixi.Assets` 載入和管理紋理
- 支援 Sprite Sheet（Texture Atlas）
- 預載入所有遊戲資源

**Sprite Pool**:

- 子彈和敵人使用物件池模式（Object Pool）
- 減少 GC（垃圾回收）壓力
- 最大池大小：子彈 100 個、敵人 50 個

### 4.2.4 Animation System

**動畫類型**:

- **Sprite Animation**：使用 `AnimatedSprite` 播放序列幀動畫
- **Tween Animation**：平滑移動和數值變化（考慮使用 gsap 或自製）
- **Particle Effects**：使用 `@pixi/particle-emitter` 處理特效

**動畫幀率**：

- 角色動畫：12 FPS
- 特效動畫：24 FPS

### 4.2.5 Collision Detection

**碰撞檢測方式**:

- AABB（Axis-Aligned Bounding Box）矩形碰撞
- 每幀檢查所有活躍實體

**碰撞組合**:

| 物件 A | 物件 B | 檢測方式       | 回應                                 |
| ------ | ------ | -------------- | ------------------------------------ |
| 子彈   | 敵人   | AABB           | 敵人扣血，子彈消失，生命歸零時收集食材 |
| 敵人   | 攤位   | AABB           | 偷取食材                             |
| 敵人   | 底線   | X 座標檢查     | 扣玩家生命                           |
| 玩家   | 敵人   | 無碰撞（穿透） | 無效果                               |
| 玩家   | 邊界   | 邊界座標限制   | 停止移動                             |

### 4.2.6 Performance Optimization

**渲染優化**:

- 使用 `ParticleContainer` 處理大量相似物件（子彈、小型敵人）
- 關閉不需要的互動性（`interactive = false`）
- 使用 `cacheAsBitmap` 快取靜態元素（攤位、HUD 背景）

**記憶體管理**:

- 銷毀不再使用的紋理和精靈
- 使用物件池減少物件建立/銷毀
- 定期清理 Ticker 監聽器

**目標效能**:

- 60 FPS（16.67ms per frame）
- 50 隻敵人 + 100 發子彈同時存在
- 記憶體使用 < 200 MB

**測試驗證**：參見 [Testing Specification](docs/testing.md) § 5 Performance Tests。

## 4.3 Browser Compatibility

**目標瀏覽器**：

- Chrome 120+
- Firefox 120+
- Safari 17+

**不支援**：

- Internet Explorer
- 行動裝置瀏覽器（此版本僅支援桌面）

**必需功能**:

- WebGL 2.0 支援
- ES2020+ 語法支援
- Keyboard API

**測試驗證**：參見 [Testing Specification](docs/testing.md) § 6 Browser Compatibility Tests。

## 4.4 Asset Requirements

**紋理格式**:

- PNG（支援透明）
- 建議使用 Sprite Sheet 減少 HTTP 請求

**音效格式**:

- MP3 或 WebM（跨瀏覽器相容）
- 背景音樂：循環播放，檔案大小 < 2 MB
- 音效：短促，檔案大小 < 100 KB

**總資產大小**:

- 目標：< 10 MB
- 上限：< 25 MB（Cloudflare Pages 限制）

## 4.5 Deployment

**建置流程**:

1. TypeScript 編譯
2. Vite 打包（生產模式）
3. 資產最佳化（壓縮圖片、音效）
4. 部署至 Cloudflare Pages

**環境變數**:

- `VITE_VERSION`：遊戲版本號
- `VITE_ENVIRONMENT`：development / production

**Cloudflare Pages 設定**:

- 建置指令：`npm run build`
- 輸出目錄：`dist`
- Node 版本：18.x

# 5. Appendix

## 5.1 Design Decisions

**已確認的設計決策**:

1. 攤位位置固定（非可移動）
2. 敵人偷取食材數量：1 個/次
3. 普通子彈傷害：1 點
4. 重裝期間可移動、不可射擊
5. 特殊子彈為臨時 Buff（不替換彈夾）
6. 總回合數：無限（直到死亡）
7. 敵人數量公式：回合數 × 2
8. Boss 出現頻率：每 5 回合
9. 合成觸發：自動（放入第 3 個食材）
10. 玩家生命系統：5 條生命（無獨立血條）
11. 玩家移動速度：200 px/s
12. 玩家碰撞箱：24×24 px
13. 食材掉落率：100%
14. 食材類型：隨機
15. 升級效果：永久持續
16. 升級可重複：可以（效果堆疊）
17. 目標解析度：1920×1080
18. 攤位區寬度：384 px
19. 夜市總匯連鎖：無限連鎖
20. 使用 Pixi.js v8 作為渲染引擎
21. 使用物件池管理子彈和敵人

## 5.2 Open Questions

**待澄清的設計細節**:

1. 玩家角色視覺設計（大小、外觀）
2. 敵人生成位置（右側畫面外多遠？）
3. 食材掉落位置（敵人死亡位置？隨機偏移？）
4. 子彈飛行距離上限（穿透類子彈何時消失？）
5. 夜市總匯閃電跳躍距離（多遠內的敵人可被連鎖？）
6. 升級選項池大小（是否只有 3 種升級？）
7. 音效和背景音樂規格
8. 視覺風格（像素風、手繪風、3D 渲染？）
9. 敵人生成間隔（同時生成還是逐個生成？）
10. 合成失敗提示（食材不足時的 UI 反饋）
11. Sprite Sheet 規格（每個精靈的尺寸和佈局）
12. 粒子特效細節（爆炸、拾取、合成特效）

## 5.3 Testing Strategy

完整的測試策略、測試案例和覆蓋率目標定義於 [Testing Specification](docs/testing.md)。

**測試層級**：

- **單元測試**：驗證個別系統和元件行為（目標覆蓋率 90%）
- **整合測試**：驗證系統間互動和資料流動（目標覆蓋率 80%）
- **驗收測試**：驗證完整遊戲流程和使用者旅程

**測試框架**：Vitest + @vitest/ui + @vitest/coverage-v8

**執行方式**：
```bash
pnpm test           # 執行測試（watch mode）
pnpm test:ui        # 測試 UI 介面
pnpm test:coverage  # 測試覆蓋率報告
```

關鍵測試面向包括：
- 所有核心系統行為（2.3 節定義的五大系統）
- 所有錯誤情境處理（Error Scenarios 表格）
- 效能指標驗證（4.2.6 節目標）
- 瀏覽器相容性（4.3 節目標瀏覽器）

詳細測試案例對照表參見 [Testing Specification](docs/testing.md)。
