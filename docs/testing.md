# Testing Specification

本文件定義驗證 `SPEC.md` 需求的測試案例。

# 1. Testing Strategy

## 1.1 Test Levels

1. **單元測試（Unit Tests）**：測試個別系統和元件
2. **整合測試（Integration Tests）**：測試系統間互動
3. **驗收測試（Acceptance Tests）**：測試完整遊戲流程

## 1.2 Test Framework

- **框架**：Vitest
- **覆蓋率目標**：80% 以上
- **執行方式**：`npm test`

## 1.3 Test Coverage Goals

| 類別     | 目標覆蓋率 |
| -------- | ---------- |
| 核心系統 | 90%        |
| 遊戲實體 | 85%        |
| UI 元件  | 70%        |
| 整合流程 | 80%        |
| **總體** | **80%**    |

# 2. Unit Tests

## 2.1 Booth System Tests

### 2.1.1 Store Food

| Test ID | Input                        | Expected Output | Accept Criteria            |
| ------- | ---------------------------- | --------------- | -------------------------- |
| BS-01   | 空攤位 + 儲存珍珠            | 攤位數量 = 1    | 攤位顯示珍珠 ×1            |
| BS-02   | 攤位 5/6 + 儲存珍珠          | 攤位數量 = 6    | 攤位顯示珍珠 ×6            |
| BS-03   | 攤位 6/6 + 儲存珍珠          | 攤位數量 = 6    | 食材消失，攤位仍為 6/6     |
| BS-04   | 珍珠攤位 + 儲存豆腐          | 儲存失敗        | 豆腐不進入珍珠攤位         |
| BS-05   | 攤位 0/6 + 連續儲存 3 個食材 | 攤位數量 = 3    | 攤位顯示食材 ×3            |
| BS-06   | 3 種攤位同時儲存不同食材     | 各攤位數量 = 1  | 每種食材進入對應攤位       |
| BS-07   | 敵人死亡掉落珍珠             | 攤位數量 = 1    | 食材自動進入攤位，珍珠 +1  |
| BS-08   | 攤位 6/6 + 敵人死亡掉落珍珠  | 攤位數量 = 6    | 食材消失（丟失），攤位不變 |

### 2.1.2 Box System (Booth Pool Defense)

| Test ID | Input                   | Expected Output       | Accept Criteria          |
| ------- | ----------------------- | --------------------- | ------------------------ |
| BS-15   | 攤位 3/6 + 敵人碰撞寶箱 | 攤位 2/6，敵人消失    | 食材 -1，敵人不掉落      |
| BS-16   | 攤位 0/6 + 敵人進入區域 | 敵人穿透到底線        | 寶箱不存在，敵人繼續前進 |
| BS-17   | 攤位 1/6 + 敵人碰撞寶箱 | 攤位 0/6，寶箱消失    | 最後食材消耗後寶箱消失   |
| BS-18   | 敵人穿透後到達底線      | 玩家生命 -1，敵人消失 | 寶箱不存在時扣玩家生命   |

## 2.2 Combat System Tests

### 2.2.1 Normal Attack

| Test ID | Input                 | Expected Output        | Accept Criteria    |
| ------- | --------------------- | ---------------------- | ------------------ |
| CS-01   | 彈夾 6/6 + 按 Space   | 彈夾 5/6，子彈生成     | 子彈向右飛行       |
| CS-02   | 彈夾 0/6 + 按 Space   | 無效果                 | 不發射子彈         |
| CS-03   | 子彈擊中餓鬼（1 HP）  | 餓鬼死亡               | 餓鬼消失，掉落食材 |
| CS-04   | 子彈擊中 Boss（3 HP） | Boss 生命 2 HP         | Boss 扣 1 HP       |
| CS-05   | 連續按 Space 6 次     | 彈夾 0/6，6 發子彈生成 | 彈夾歸零           |
| CS-06   | 子彈飛出畫面右邊界    | 子彈消失               | 子彈離開畫面後銷毀 |
| CS-07   | 子彈未擊中任何敵人    | 子彈繼續飛行           | 子彈直到飛出畫面   |

### 2.2.2 Reload

| Test ID | Input                      | Expected Output    | Accept Criteria |
| ------- | -------------------------- | ------------------ | --------------- |
| CS-08   | 彈夾 0/6 + 等待 3 秒       | 彈夾 6/6           | 彈夾恢復滿載    |
| CS-09   | 重裝中（1.5 秒）+ 按 Space | 無效果             | 不發射子彈      |
| CS-10   | 重裝中 + 按 WASD           | 玩家移動           | 玩家正常移動    |
| CS-11   | 彈夾 0/6 + 等待 1.5 秒     | 彈夾 0/6           | 重裝未完成      |
| CS-12   | 重裝完成瞬間 + 按 Space    | 彈夾 5/6，子彈生成 | 可正常射擊      |

### 2.2.3 Special Bullet

| Test ID | Input                                 | Expected Output                   | Accept Criteria                  |
| ------- | ------------------------------------- | --------------------------------- | -------------------------------- |
| CS-13   | 蚵仔煎 + 擊中 Boss (100 HP)           | 造成 10 HP 傷害                   | Boss 受到 10% 當前 HP 傷害       |
| CS-13a  | 蚵仔煎 + 擊中受傷 Boss (60 HP → 6 HP) | 造成 1 HP 傷害（6×0.1 向上取整）  | 基於當前 HP 計算，非最大 HP      |
| CS-14   | 蚵仔煎 + 擊中菁英 (10 HP)             | 造成 5 HP 傷害                    | 菁英受到 50% 當前 HP 傷害        |
| CS-14a  | 蚵仔煎 + 擊中受傷菁英 (4 HP → 3 HP)   | 造成 2 HP 傷害（3×0.5 向上取整）  | 基於當前 HP 計算，非最大 HP      |
| CS-15   | 蚵仔煎 + 擊中小怪 (1 HP)              | 造成 0.7 HP（四捨五入為 1）傷害   | 小怪受到 70% 當前 HP 傷害        |
| CS-16   | 臭豆腐 Buff + 按 Space                | 貫穿子彈                          | 子彈擊中敵人不消失，貫穿 1 敵人  |
| CS-17   | 珍珠奶茶 Buff + 按 Space              | 散射多個子彈                      | 三向散射，初始+1顆子彈           |
| CS-18   | 豬血糕 Buff + 按 Space                | 追蹤子彈                          | 子彈自動追蹤敵人，命中-10%移速   |
| CS-19   | 夜市總匯 Buff + 擊中第 1 隻敵人       | 閃電連鎖，最多 5 目標，每命中-20% | 連鎖閃電直到目標數達上限或無敵人 |
| CS-20   | Buff 結束（2 秒後）+ 按 Space         | 普通子彈                          | 子彈恢復正常                     |
| CS-21   | 特殊 Buff 期間 + 按數字鍵             | 無效果                            | 無法再次合成                     |
| CS-22   | Buff 剩餘 0.5 秒 + 按 Space           | 特殊子彈                          | Buff 期間仍有效                  |

### 2.2.4 Bullet Visual Effects

**測試目標**: 驗證子彈視覺效果符合 SPEC.md § 2.6.3 規格，確保「極度浮誇」、「高辨識度」與「毀滅性打擊感」。

#### 2.2.4.1 普通子彈視覺效果

| Test ID | Visual Element | Expected Behavior                         | Accept Criteria                  |
| ------- | -------------- | ----------------------------------------- | -------------------------------- |
| VE-01   | 槍口閃光       | 發射瞬間白色閃光，持續 50ms               | 白色光暈半徑 24px，透明度 80%→0% |
| VE-02   | 飛行尾跡       | 尾端拖著 3 條白色風切線條，長度 32px      | 線條逐漸消散，生命週期 200ms     |
| VE-03   | 視覺誇張       | 視覺尺寸 16×16 px，實際判定 8×8 px        | 視覺誇張倍率 2x                  |
| VE-04   | 受擊閃白       | 擊中敵人時敵人精靈閃白 100ms              | 閃白效果清晰，不影響遊戲畫面     |
| VE-05   | 命中爆裂       | 白色 Pop 爆裂特效，20 粒子噴濺，半徑 16px | 簡潔清晰，不搶特殊子彈風采       |

#### 2.2.4.2 夜市總匯視覺效果（連鎖閃電）

| Test ID | Visual Element | Expected Behavior                                         | Accept Criteria                                 |
| ------- | -------------- | --------------------------------------------------------- | ----------------------------------------------- |
| VE-06   | 槍口電流爆發   | 發射瞬間金黃色電流爆發，持續 100ms                        | 金黃色光暈半徑 48px，電流粒子 50 個             |
| VE-07   | 飛行電流環繞   | 子彈周圍 5 條金黃色電流螺旋軌跡，電流粒子 100 個/秒       | 電流螺旋半徑 40px，動畫流暢                     |
| VE-08   | Bloom 發光     | 金黃色高光效果，光暈半徑 48px                             | Bloom 強度 200%，顏色 #FFD700                   |
| VE-09   | 視覺誇張       | 視覺尺寸 32×32 px，實際判定 16×16 px                      | 視覺誇張倍率 2x                                 |
| VE-10   | 受擊閃白       | 第一敵人閃金黃色 150ms                                    | 閃白效果明顯                                    |
| VE-11   | 閃電鏈         | 金黃色閃電鏈折射至 4 個敵人，每條寬度 4px，持續 300ms     | 閃電鏈粒子 200 個，速度 800px/s，路徑帶扭曲動畫 |
| VE-12   | 連鎖目標閃爍   | 被鏈結敵人全身金光閃爍 300ms，身上爆發電流粒子 50 個/目標 | 閃爍效果明顯但不刺眼                            |
| VE-13   | 螢幕震動       | 輕微震動，振幅 2px，持續 100ms                            | Screen Shake 頻率 30Hz，不過度                  |
| VE-14   | 最終爆炸       | 最後連鎖目標爆發金黃色電流爆炸，半徑 64px，粒子 150 個    | Bloom 效果強度 200%，生命週期 500ms             |
| VE-15   | 地面灼燒       | 命中位置留下金黃色電流灼燒痕跡，持續 1 秒後消散           | 地面特效 32×32 px，透明度 80%→0%                |
| VE-16   | 整體視覺範圍   | 視覺效果範圍 200×200 px，實際判定 16×16 px                | 視覺誇張倍率 12.5x，營造毀滅性印象              |

#### 2.2.4.3 臭豆腐視覺效果（貫穿毒霧）

| Test ID | Visual Element | Expected Behavior                                          | Accept Criteria                  |
| ------- | -------------- | ---------------------------------------------------------- | -------------------------------- |
| VE-17   | 槍口毒霧爆發   | 發射瞬間綠色毒霧爆發，持續 150ms                           | 綠色霧氣半徑 40px，粒子 80 個    |
| VE-18   | 飛行氣體尾跡   | 豆腐後方 5 條波浪狀綠色氣體尾跡，長度 80px，粒子 150 個/秒 | 波浪動畫頻率 10Hz，透明度 70%→0% |
| VE-19   | Bloom 發光     | 綠色高光效果，光暈半徑 36px                                | Bloom 強度 180%，顏色 #00FF00    |
| VE-20   | 視覺誇張       | 視覺尺寸 24×24 px，實際判定 12×12 px                       | 視覺誇張倍率 2x                  |
| VE-21   | 貫穿爆炸       | 穿過敵人背後爆出大團綠色臭氣雲，半徑 80px，粒子 200 個     | 臭氣雲持續 500ms，帶毒霧擴散動畫 |
| VE-22   | 螢幕震動       | 貫穿震動，振幅 3px，持續 150ms                             | Screen Shake 頻率 25Hz           |
| VE-23   | 地面腐蝕       | 貫穿位置留下綠色腐蝕痕跡，持續 1.5 秒後消散                | 地面特效 48×48 px，帶氣泡動畫    |
| VE-24   | 整體視覺範圍   | 視覺效果範圍 160×160 px，實際判定 12×12 px                 | 視覺誇張倍率 13.3x               |

#### 2.2.4.4 珍珠奶茶視覺效果（三向散射）

| Test ID | Visual Element | Expected Behavior                                         | Accept Criteria                          |
| ------- | -------------- | --------------------------------------------------------- | ---------------------------------------- |
| VE-25   | 槍口珍珠雨     | 發射瞬間三顆巨大黑珍珠同時生成，扇形角度 45°              | 珍珠尺寸 32×32 px，夾角 -22.5°/0°/+22.5° |
| VE-26   | 飛行霧氣環繞   | 每顆珍珠周圍奶茶霧氣粒子 50 個，半徑 48px                 | 霧氣透明度 60%→0%，珍珠表面帶高光動畫    |
| VE-27   | Bloom 發光     | 黑珍珠帶白色光環，光暈半徑 40px                           | Bloom 強度 150%，顏色 #FFFFFF            |
| VE-28   | 視覺誇張       | 視覺尺寸 32×32 px，實際判定 10×10 px                      | 視覺誇張倍率 3.2x（巨大圓潤黑珍珠）      |
| VE-29   | 命中液體噴濺   | 白色奶茶液體噴濺，半徑 64px，粒子 120 個                  | 液體粒子速度 180px/s，帶彈跳動畫         |
| VE-30   | 三顆同時命中   | 同時命中同一敵人觸發連續受擊閃白 3 次，間隔 50ms          | 閃白疊加效果清晰                         |
| VE-31   | 螢幕震動       | 每顆命中震動 1px，三顆同時命中則振幅 3px，持續 80ms       | Screen Shake 不過度                      |
| VE-32   | 地面液體痕跡   | 命中位置留下白色奶茶液體痕跡，持續 0.8 秒後消散           | 地面特效 40×40 px                        |
| VE-33   | 整體視覺範圍   | 每顆珍珠視覺範圍 96×96 px，散射覆蓋範圍 300px（扇形 45°） | 視覺誇張倍率 9.6x                        |

#### 2.2.4.5 豬血糕視覺效果（追蹤黏液）

| Test ID | Visual Element | Expected Behavior                                        | Accept Criteria                                   |
| ------- | -------------- | -------------------------------------------------------- | ------------------------------------------------- |
| VE-34   | 槍口黏液噴發   | 發射瞬間黑紅色黏稠液體爆發，持續 120ms                   | 黏液半徑 36px，粒子 60 個，帶拉絲動畫             |
| VE-35   | 飛行螺旋軌跡   | 螺旋軌跡飛向最近敵人，尾部 7 條黑色黏稠殘影線，長度 96px | 殘影透明度 80%→0%，螺旋半徑 64px，轉向速度 180°/s |
| VE-36   | 追蹤行為       | 非直線飛行，波浪狀螺旋，追蹤距離限制 600px               | 軌跡粒子 100 個/秒，波浪頻率 8Hz                  |
| VE-37   | Bloom 發光     | 黑紅色高光效果，光暈半徑 42px                            | Bloom 強度 160%，顏色 #8B0000                     |
| VE-38   | 視覺誇張       | 視覺尺寸 28×28 px，實際判定 14×14 px                     | 視覺誇張倍率 2x                                   |
| VE-39   | 命中黏液爆炸   | 黑色黏液噴濺，半徑 72px，粒子 180 個，帶重力下墜效果     | 黏液粒子速度 120px/s（緩慢）                      |
| VE-40   | 緩速視覺       | 被命中敵人身上附著黑色黏液 2 秒，移速 -10%，帶黏液拖尾   | 敵人身上黏液粒子 40 個                            |
| VE-41   | 螢幕震動       | 命中震動，振幅 2px，持續 100ms                           | Screen Shake 頻率 28Hz                            |
| VE-42   | 地面黏液痕跡   | 命中位置留下黑色血糕痕跡，持續 2 秒後消散                | 地面特效 56×56 px，帶黏液擴散動畫                 |
| VE-43   | 整體視覺範圍   | 視覺效果範圍 168×168 px，實際判定 14×14 px               | 視覺誇張倍率 12x                                  |

#### 2.2.4.6 蚵仔煎視覺效果（終極爆炸）

| Test ID | Visual Element | Expected Behavior                                          | Accept Criteria                                     |
| ------- | -------------- | ---------------------------------------------------------- | --------------------------------------------------- |
| VE-44   | 槍口火焰爆發   | 發射瞬間紅色甜辣醬火焰爆發，全螢幕閃紅光 200ms             | 火焰半徑 96px，全螢幕閃光透明度 40%→0%，粒子 300 個 |
| VE-45   | 飛行拋物線     | 巨大投擲物沿拋物線飛行，尾部 10 條紅色火焰尾跡，長度 160px | 重力加速度 400px/s²，尾跡粒子 300 個/秒             |
| VE-46   | Bloom 發光     | 紅色超強高光效果，光暈半徑 128px，強度隨飛行增強           | Bloom 強度 300%，顏色 #FF0000，呼吸頻率 5Hz         |
| VE-47   | 視覺誇張       | 視覺尺寸 128×128 px，實際判定 32×32 px                     | 視覺誇張倍率 4x（巨大投擲物）                       |
| VE-48   | 飛行音效       | 持續低頻震動音效，音量隨接近目標增強                       | 低頻 60Hz，音量 50%→100%                            |
| VE-49   | 命中超大爆炸   | 紅色甜辣醬爆炸，半徑 256px，粒子 500 個，帶衝擊波動畫      | 爆炸速度 300px/s，生命週期 1s                       |
| VE-50   | 全螢幕震動     | 超強震動，振幅 8px，持續 500ms                             | Screen Shake 頻率 20Hz，震動感強烈但不過度          |
| VE-51   | 受擊閃白       | 敵人閃紅白色 300ms                                         | 閃白效果極強                                        |
| VE-52   | 爆炸衝擊波     | 紅色圓形衝擊波從命中點向外擴散，半徑 512px，持續 800ms     | 衝擊波透明度 100%→0%，擴散速度 640px/s，帶熱扭曲    |
| VE-53   | 全螢幕閃光     | 爆炸瞬間全螢幕閃紅光 3 次，間隔 100ms                      | 每次閃光透明度 60%→0%，頻率 10Hz                    |
| VE-54   | 時間凍結       | 命中瞬間畫面凍結 100ms，然後爆炸                           | Freeze Frame 效果增強戲劇性                         |
| VE-55   | 地面灼燒痕跡   | 命中位置留下巨大紅色甜辣醬灼燒痕跡，持續 3 秒後消散        | 地面特效 128×128 px，帶火焰殘留動畫                 |
| VE-56   | 周圍敵人反應   | 爆炸範圍 256px 內所有敵人同時受擊，同步閃白，噴發紅色粒子  | 80 粒子/敵人，同步動畫                              |
| VE-57   | 整體視覺範圍   | 視覺效果範圍 512×512 px，實際判定 32×32 px                 | 視覺誇張倍率 16x，營造極致毀滅性印象                |

#### 2.2.4.7 通用視覺效果測試

| Test ID | Test Item    | Expected Behavior                       | Accept Criteria                         |
| ------- | ------------ | --------------------------------------- | --------------------------------------- |
| VE-58   | 辨識度       | 5 種特殊子彈視覺差異明顯，不易混淆      | 玩家可在 0.5 秒內快速識別當前子彈類型   |
| VE-59   | 打擊感       | 命中敵人時視覺反饋清晰有力，即時反饋    | 受擊閃白 + 粒子爆炸 + Screen Shake 同步 |
| VE-60   | 粒子密度     | 普通 20~50，特殊 50~200，終極 300~500   | 粒子數量符合規格                        |
| VE-61   | Bloom 強度   | 普通 0%，特殊 150~200%，終極 300%       | 發光效果明顯但不過度                    |
| VE-62   | Screen Shake | 振幅 1~8px，持續 80~500ms，頻率 20~30Hz | 震動效果明顯但不影響遊戲體驗            |
| VE-63   | 視覺誇張     | 視覺尺寸 = 判定尺寸 × 1.5~16x           | 視覺遠大於判定，營造毀滅性印象          |
| VE-64   | 尾跡長度     | 普通 32px，特殊 48~96px，終極 160px     | 尾跡視覺華麗，不影響辨識度              |

**視覺效果測試方法**:

- **單元測試層級**：驗證粒子系統初始化、參數配置正確（粒子數量、生命週期、速度、Bloom 強度、Screen Shake 振幅）
- **整合測試層級**：驗證視覺效果與遊戲邏輯同步（如：連鎖特效與連鎖傷害同時發生，緩速視覺與移速降低同步）
- **手動測試層級**：玩家視角驗證視覺辨識度、打擊感、流暢度、視覺誇張度

**視覺效果品質標準（更新）**:

| 評估項目   | 標準                                                             |
| ---------- | ---------------------------------------------------------------- |
| 辨識度     | 5 種特殊子彈視覺差異明顯，玩家可在 0.5 秒內快速識別              |
| 打擊感     | 命中特效清晰有力，即時反饋（受擊閃白 + 粒子爆炸 + Screen Shake） |
| 視覺誇張   | 視覺尺寸遠大於判定範圍（誇張倍率 1.5~16x）                       |
| 粒子華麗度 | 粒子數量充足（50~500 個），視覺華麗且不影響效能                  |
| 效能影響   | 視覺效果不影響 FPS（極限負載維持 ≥55 FPS）                       |
| 視覺干擾   | 特效不遮蓋重要遊戲資訊（敵人、玩家、HUD）                        |
| 毀滅性印象 | 子彈視覺呈現毀滅性能量，參考 Vampire Survivors / Brotato 風格    |

## 2.3 Synthesis System Tests

### 2.3.1 Decision Table: Synthesis Recipes

| Test ID | 珍珠 | 豆腐 | 米血 | 擊殺數 | 按鍵 | Expected Recipe | Buff Duration | Accept Criteria                                                  |
| ------- | ---- | ---- | ---- | ------ | ---- | --------------- | ------------- | ---------------------------------------------------------------- |
| SY-01   | 3    | 0    | 0    | 0      | 3    | 珍珠奶茶        | 2s            | 散射                                                             |
| SY-02   | 0    | 3    | 0    | 0      | 2    | 臭豆腐          | 2s            | 貫穿                                                             |
| SY-03   | 0    | 0    | 3    | 0      | 4    | 豬血糕          | 2s            | 追蹤彈                                                           |
| SY-04   | 2    | 1    | 0    | 0      | 3    | 珍珠奶茶        | 2s            | 散射（剩餘珍珠2）                                                |
| SY-05   | 1    | 2    | 0    | 0      | 2    | 臭豆腐          | 2s            | 貫穿（剩餘豆腐2）                                                |
| SY-06   | 2    | 0    | 1    | 0      | 3    | 珍珠奶茶        | 2s            | 散射（剩餘珍珠2）                                                |
| SY-07   | 1    | 0    | 2    | 0      | 4    | 豬血糕          | 2s            | 追蹤彈（剩餘米血2）                                              |
| SY-08   | 0    | 2    | 1    | 0      | 2    | 臭豆腐          | 2s            | 貫穿（剩餘豆腐2）                                                |
| SY-09   | 0    | 1    | 2    | 0      | 4    | 豬血糕          | 2s            | 追蹤彈（剩餘米血2）                                              |
| SY-10   | 1    | 1    | 1    | 0      | 5    | 夜市總匯        | 2s            | 連鎖閃電，最多 5 目標，每命中 -20% 傷害衰減                      |
| SY-11   | 0    | 0    | 0    | ≥20    | 5    | 蚵仔煎          | 單發          | 百分比傷害：Boss 10% HP, 菁英 50% HP, 小怪 70% HP，消耗擊殺數 20 |

### 2.3.2 Trigger Special Bullets

| Test ID | Input                         | Expected Output    | Accept Criteria                         |
| ------- | ----------------------------- | ------------------ | --------------------------------------- |
| SY-12   | 按 1（夜市總匯）              | Buff 啟動 2s       | 消耗豆腐1珍珠1米血1                     |
| SY-13   | 按 2（臭豆腐）                | Buff 啟動 2s       | 消耗豆腐3                               |
| SY-14   | 按 3（珍珠奶茶）              | Buff 啟動 2s       | 消耗珍珠3                               |
| SY-15   | 按 4（豬血糕）                | Buff 啟動 2s       | 消耗米血3                               |
| SY-16   | 按 5（蚵仔煎），擊殺數≥20     | 蚵仔煎發射（單發） | 消耗擊殺數 20，擊殺數 -20               |
| SY-17   | 按 5（蚵仔煎），擊殺數<20     | 無反應             | UI 提示擊殺數不足                       |
| SY-18   | 按 1，食材不足                | 無反應             | UI 提示庫存不足                         |
| SY-19   | Buff 期間按 1                 | 無反應             | 無法疊加 Buff                           |
| SY-20   | Buff 結束後按 5，擊殺數≥20    | 蚵仔煎發射         | 蚵仔煎可重複使用，再次消耗 20           |
| SY-21   | 選「打折」後按 2              | 消耗豆腐2          | 打折效果永久生效                        |
| SY-22   | 選「快吃」後按 5，擊殺數≥20   | 蚵仔煎發射         | 快吃效果：蚵仔煎傷害 +10%               |
| SY-23   | 打折後按 2                    | 消耗豆腐2（最低1） | 打折效果（3→2）                         |
| SY-24   | 擊殺 25 隻 + 選「快吃」+ 按 5 | 蚵仔煎發射         | 消耗仍為 20，快吃效果增加傷害而非減消耗 |
| SY-25   | 擊殺 15 隻 + 按 5             | 無反應             | 消耗需 20，15<20 不可觸發               |

## 2.4 Upgrade System Tests

### 2.4.1 Decision Table: Upgrade Availability

| Test ID | 豆腐庫存 | 珍珠庫存 | 米血庫存 | 升級選項 | Available | Accept Criteria    |
| ------- | -------- | -------- | -------- | -------- | --------- | ------------------ |
| UP-01   | 0        | 0        | 0        | 加辣     | ✓         | 無消耗，總是可選擇 |
| UP-02   | 0        | 0        | 0        | 加椰果   | ✓         | 無消耗，總是可選擇 |
| UP-03   | 0        | 0        | 0        | 加香菜   | ✓         | 無消耗，總是可選擇 |
| UP-04   | 6        | 6        | 6        | 任一     | ✓         | 無消耗，總是可選擇 |
| UP-05   | 0        | 0        | 0        | 打折     | ✓         | Boss升級，總是可選 |
| UP-06   | 0        | 0        | 0        | 大胃王   | ✓         | Boss升級，總是可選 |
| UP-07   | 0        | 0        | 0        | 快吃     | ✓         | Boss升級，總是可選 |
| UP-08   | 0        | 0        | 0        | 飢餓三十 | ✓         | Boss升級，總是可選 |

### 2.4.2 Present Options

| Test ID | Input        | Expected Output    | Accept Criteria |
| ------- | ------------ | ------------------ | --------------- |
| UP-09   | 回合結束     | 顯示 2 個升級選項  | 隨機抽取        |
| UP-10   | 多次回合結束 | 選項組合不全相同   | 隨機性          |
| UP-11   | 升級選項顯示 | 包含效果和消耗說明 | UI 顯示完整資訊 |

### 2.4.3 Apply Upgrade

| Test ID | Input                      | Expected Output                | Accept Criteria  |
| ------- | -------------------------- | ------------------------------ | ---------------- |
| UP-12   | 選擇「加辣」               | 臭豆腐傷害倍率 +0.5            | 無消耗，效果套用 |
| UP-13   | 已選「加辣」+ 再選「加辣」 | 臭豆腐傷害倍率再 +0.5          | 效果堆疊         |
| UP-14   | 第 2 回合選「加辣」        | 第 5 回合臭豆腐傷害倍率仍 +0.5 | 永久效果         |
| UP-15   | 未選擇任何選項             | 無法進入下一回合               | 必須選擇升級     |
| UP-16   | 選擇升級後                 | 進入下一回合                   | 回合數 +1        |
| UP-17   | 選擇「打折」               | 特殊子彈消耗 -1（永久）        | Boss升級效果套用 |
| UP-18   | 選擇「快吃」               | 蚵仔煎傷害 +10%                | Boss升級效果套用 |
| UP-19   | 打折後消耗                 | 3→2（最低 1）                  | 打折效果正確     |

### 2.4.4 Boss Upgrade Limits

| Test ID | Input                  | Expected Output        | Accept Criteria                  |
| ------- | ---------------------- | ---------------------- | -------------------------------- |
| UP-20   | 選「打折」1 次         | 打折從升級池移除       | 最大次數 1                       |
| UP-21   | 選「大胃王」3 次       | 大胃王從升級池移除     | 最大次數 3，彈匣 6→12→18→24      |
| UP-22   | 選「快吃」1 次         | 快吃從升級池移除       | 最大次數 1                       |
| UP-23   | 選「飢餓三十」4 次     | 飢餓三十從升級池移除   | 最大次數 4，Buff 2s→4s→6s→8s→10s |
| UP-24   | 選「總匯吃到飽」2 次   | 總匯吃到飽從升級池移除 | 最大次數 2，鏈結 5→10→20         |
| UP-25   | 選「好餓好餓」3 次     | 好餓好餓從升級池移除   | 最大次數 3，換彈 3s→2.5s→2s→1.5s |
| UP-26   | 所有 Boss 升級選完     | 不再出現 Boss 升級選項 | 升級池清空                       |
| UP-27   | Boss 升級池剩 1 個選項 | 顯示 1 個選項          | 自動選擇僅剩選項                 |

### 2.4.5 New Upgrade Effects

| Test ID | Input              | Expected Output               | Accept Criteria     |
| ------- | ------------------ | ----------------------------- | ------------------- |
| UP-28   | 總匯吃到飽 1 次    | 夜市總匯鏈結 5→10 目標        | 鏈結數 ×2           |
| UP-29   | 總匯吃到飽 1 次    | 衰減 20%→10%/人               | 衰減 -10%/人        |
| UP-30   | 總匯吃到飽 2 次    | 鏈結 5→10→20，衰減 20%→10%→0% | 效果堆疊正確        |
| UP-31   | 好餓好餓 1 次      | 換彈時間 3s→2.5s              | 換彈 -0.5s          |
| UP-32   | 好餓好餓 2 次      | 換彈時間 3s→2.5s→2s           | 效果堆疊正確        |
| UP-33   | 好餓好餓 3 次      | 換彈時間 3s→2.5s→2s→1.5s      | 最大 3 次後從池移除 |
| UP-34   | 總匯吃到飽後按 5   | 閃電連鎖 10 目標              | 升級效果正確應用    |
| UP-35   | 好餓好餓後彈夾 0/6 | 2.5s 後重裝完成               | 升級效果正確應用    |

## 2.5 Wave System Tests

### 2.5.1 Decision Table: Enemy Spawning

| Test ID | 回合數 | 一般敵人數 | Boss 數 | 總敵人數 | Accept Criteria      |
| ------- | ------ | ---------- | ------- | -------- | -------------------- |
| WS-01   | 1      | 2          | 0       | 2        | 公式：回合數 × 2     |
| WS-02   | 2      | 4          | 0       | 4        | 公式：回合數 × 2     |
| WS-03   | 5      | 10         | 1       | 11       | Boss 每 5 回合出現   |
| WS-04   | 10     | 20         | 1       | 21       | Boss 每 5 回合出現   |
| WS-05   | 15     | 30         | 1       | 31       | Boss 每 5 回合出現   |
| WS-06   | 6      | 12         | 0       | 12       | 非 5 倍數回合無 Boss |
| WS-07   | 25     | 50         | 1       | 51       | 最大敵人數測試       |

### 2.5.2 Wave Progression

| Test ID | Input             | Expected Output | Accept Criteria        |
| ------- | ----------------- | --------------- | ---------------------- |
| WS-08   | 擊敗最後 1 隻敵人 | 觸發升級畫面    | 回合結束               |
| WS-09   | 升級完成          | 進入下一回合    | 回合數 +1，生成新敵人  |
| WS-10   | 玩家生命值 = 0    | 遊戲結束        | 不進入下一回合         |
| WS-11   | 所有敵人到達底線  | 觸發升級畫面    | 敵人清空（即使未擊殺） |

## 2.6 Player Tests

### 2.6.1 Movement

| Test ID | Input                       | Expected Output  | Accept Criteria                        |
| ------- | --------------------------- | ---------------- | -------------------------------------- |
| PL-01   | 玩家 (500, 500) + 按 W 1 秒 | 玩家 (500, 300)  | 向上移動 200 px                        |
| PL-02   | 玩家 (500, 500) + 按 A 1 秒 | 玩家 (468, 500)  | 向左移動但受左邊界限制（考慮玩家大小） |
| PL-03   | 玩家 (500, 500) + 按 S 1 秒 | 玩家 (500, 700)  | 向下移動 200 px                        |
| PL-04   | 玩家 (500, 500) + 按 D 1 秒 | 玩家 (700, 500)  | 向右移動 200 px                        |
| PL-05   | 玩家 (500, 500) + 按 A      | 玩家 (468, 500)  | 碰到左邊界停止（考慮玩家大小 128px）   |
| PL-06   | 玩家 (1800, 500) + 按 D     | 玩家 (1792, 500) | 碰到右邊界停止（考慮玩家大小 128px）   |
| PL-07   | 玩家 (500, 300) + 按 W      | 玩家 (500, 214)  | 碰到上邊界停止（考慮玩家大小 128px）   |
| PL-08   | 玩家 (500, 800) + 按 S      | 玩家 (500, 826)  | 碰到下邊界停止（考慮玩家大小 128px）   |
| PL-09   | 同時按 W + D                | 玩家向右上移動   | 對角線移動                             |

### 2.6.2 Collision

| Test ID | Input                                 | Expected Output | Accept Criteria   |
| ------- | ------------------------------------- | --------------- | ----------------- |
| PL-10   | 玩家中心 (500, 500) + 敵人 (512, 500) | 無碰撞          | 距離 > 24，無效果 |
| PL-11   | 玩家中心 (500, 500) + 敵人 (510, 500) | 無碰撞（穿透）  | 玩家不受傷        |
| PL-12   | 碰撞箱測試                            | 24×24 px        | 碰撞箱大小正確    |

### 2.6.3 Health

| Test ID | Input                 | Expected Output  | Accept Criteria  |
| ------- | --------------------- | ---------------- | ---------------- |
| PL-13   | 生命 5 + 敵人到達底線 | 生命 4           | 扣 1 條生命      |
| PL-14   | 生命 1 + 敵人到達底線 | 生命 0，遊戲結束 | 觸發遊戲結束畫面 |
| PL-15   | 遊戲結束畫面          | 顯示存活回合數   | 統計資訊正確     |

## 2.7 Enemy Tests

### 2.7.1 Ghost (餓鬼) - 小怪

| Test ID | Input                    | Expected Output       | Accept Criteria |
| ------- | ------------------------ | --------------------- | --------------- |
| EN-01   | 餓鬼 (1000, 500) + 1 秒  | 餓鬼 (950, 500)       | 向左移動 50 px  |
| EN-02   | 餓鬼 1 HP + 普通子彈擊中 | 餓鬼死亡              | 餓鬼消失        |
| EN-03   | 餓鬼死亡                 | **無掉落**            | 小怪不掉落食材  |
| EN-04   | 餓鬼死亡位置 (500, 500)  | 無食材生成            | 小怪不掉落      |
| EN-05   | 餓鬼到達 x = 384         | 玩家生命 -1，餓鬼消失 | 到達底線        |

### 2.7.2 Elite (菁英敵人) - 彩色餓鬼

| Test ID | Input                      | Expected Output     | Accept Criteria |
| ------- | -------------------------- | ------------------- | --------------- |
| EN-06   | 紅餓鬼 2 HP + 1 發普通子彈 | 紅餓鬼 1 HP         | 扣 1 HP         |
| EN-07   | 紅餓鬼死亡                 | 掉落豆腐            | 100% 掉豆腐     |
| EN-08   | 綠餓鬼死亡                 | 掉落珍珠            | 100% 掉珍珠     |
| EN-09   | 藍餓鬼死亡                 | 掉落米血            | 100% 掉米血     |
| EN-10   | 彩色餓鬼 (1000, 500) + 1s  | 彩色餓鬼 (960, 500) | 向左移動 40 px  |

### 2.7.3 Boss (餓死鬼)

| Test ID | Input                     | Expected Output        | Accept Criteria |
| ------- | ------------------------- | ---------------------- | --------------- |
| EN-11   | 餓死鬼 (1000, 500) + 1 秒 | 餓死鬼 (970, 500)      | 向左移動 30 px  |
| EN-12   | 餓死鬼 10 HP + 普通子彈   | 餓死鬼 9 HP            | 扣 1 HP         |
| EN-13   | 餓死鬼 10 HP + 10 發子彈  | 餓死鬼死亡             | 10 次攻擊擊殺   |
| EN-14   | 餓死鬼到達 x = 384        | 玩家生命 -1，Boss 消失 | 到達底線        |
| EN-15   | 餓死鬼死亡                | 觸發 Boss 升級選項     | 提供特殊升級    |

### 2.7.4 HP Growth (HP 成長公式)

| Test ID | Enemy Type | Wave | Expected HP | Accept Criteria               |
| ------- | ---------- | ---- | ----------- | ----------------------------- |
| EN-16   | 餓鬼       | 1    | 1           | floor(1 + (1-1) × 0.03) = 1   |
| EN-17   | 餓鬼       | 5    | 1           | floor(1 + (5-1) × 0.03) = 1   |
| EN-18   | 餓鬼       | 10   | 1           | floor(1 + (10-1) × 0.03) = 1  |
| EN-19   | 餓鬼       | 15   | 1           | floor(1 + (15-1) × 0.03) = 1  |
| EN-20   | 彩色餓鬼   | 1    | 2           | round(2 + (1-1) × 0.6) = 2    |
| EN-21   | 彩色餓鬼   | 5    | 4           | round(2 + (5-1) × 0.6) = 4    |
| EN-22   | 彩色餓鬼   | 10   | 7           | round(2 + (10-1) × 0.6) = 7   |
| EN-23   | 彩色餓鬼   | 15   | 10          | round(2 + (15-1) × 0.6) = 10  |
| EN-24   | 餓死鬼     | 5    | 10          | round(10 + (5-5) × 1.5) = 10  |
| EN-25   | 餓死鬼     | 10   | 18          | round(10 + (10-5) × 1.5) = 18 |
| EN-26   | 餓死鬼     | 15   | 25          | round(10 + (15-5) × 1.5) = 25 |
| EN-27   | 餓瘋鬼     | 5    | 10          | round(10 + (5-5) × 1.5) = 10  |
| EN-28   | 餓瘋鬼     | 10   | 18          | round(10 + (10-5) × 1.5) = 18 |
| EN-29   | 餓瘋鬼     | 15   | 25          | round(10 + (15-5) × 1.5) = 25 |
| EN-30   | 餓幼鬼     | 5    | 6           | round(6 + (5-5) × 1.0) = 6    |
| EN-31   | 餓幼鬼     | 10   | 11          | round(6 + (10-5) × 1.0) = 11  |
| EN-32   | 餓幼鬼     | 15   | 16          | round(6 + (15-5) × 1.0) = 16  |

### 2.7.5 Boss Types

| Test ID | Boss Type | Behavior | Speed | Accept Criteria    |
| ------- | --------- | -------- | ----- | ------------------ |
| EN-33   | 餓死鬼    | 直走     | 0.3   | 只向左移動         |
| EN-34   | 餓瘋鬼    | 斜走     | 0.3   | 斜向移動           |
| EN-35   | 餓幼鬼    | 直走     | 0.7   | 速度比其他 Boss 快 |

### 2.7.6 Box Interaction

| Test ID | Input                   | Expected Output    | Accept Criteria        |
| ------- | ----------------------- | ------------------ | ---------------------- |
| EN-36   | 攤位 3/6 + 敵人碰撞寶箱 | 食材 2/6，敵人消失 | 寶箱阻擋敵人           |
| EN-37   | 敵人被寶箱消滅          | 不計入擊殺數       | 不觸發 EnemyDeath 事件 |
| EN-38   | 攤位 0/6 + 敵人進入區域 | 敵人穿透到底線     | 寶箱不存在，扣玩家生命 |

## 2.8 Vector Tests

### 2.8.1 Construction and Properties

| Test ID | Input              | Expected Output | Accept Criteria    |
| ------- | ------------------ | --------------- | ------------------ |
| VT-01   | Vector(10, 20)     | x=10, y=20      | 正確建立向量       |
| VT-02   | Vector(10.7, 20.3) | x=11, y=20      | 座標四捨五入為整數 |
| VT-03   | Vector(-5, -10)    | x=-5, y=-10     | 支援負數座標       |
| VT-04   | Vector(0, 0)       | x=0, y=0        | 零向量             |

### 2.8.2 add Operation

| Test ID | Input                             | Expected Output | Accept Criteria |
| ------- | --------------------------------- | --------------- | --------------- |
| VT-05   | Vector(10, 20).add(Vector(5, 3))  | Vector(15, 23)  | 向量加法        |
| VT-06   | Vector(10, 20).add(Vector(-5, 3)) | Vector(5, 23)   | 負數加法        |
| VT-07   | Vector(0, 0).add(Vector(5, 3))    | Vector(5, 3)    | 零向量加法      |
| VT-08   | Vector(10, 20).add(null)          | 拋出 TypeError  | 參數驗證        |

### 2.8.3 subtract Operation

| Test ID | Input                                   | Expected Output | Accept Criteria |
| ------- | --------------------------------------- | --------------- | --------------- |
| VT-09   | Vector(10, 20).subtract(Vector(5, 3))   | Vector(5, 17)   | 向量減法        |
| VT-10   | Vector(10, 20).subtract(Vector(15, 25)) | Vector(-5, -5)  | 結果為負數      |
| VT-11   | Vector(10, 20).subtract(Vector(10, 20)) | Vector(0, 0)    | 結果為零向量    |
| VT-12   | Vector(10, 20).subtract(undefined)      | 拋出 TypeError  | 參數驗證        |

### 2.8.4 multiply Operation

| Test ID | Input                             | Expected Output  | Accept Criteria    |
| ------- | --------------------------------- | ---------------- | ------------------ |
| VT-13   | Vector(10, 20).multiply(2)        | Vector(20, 40)   | 純量乘法           |
| VT-14   | Vector(10, 20).multiply(0)        | Vector(0, 0)     | 乘以 0 返回零向量  |
| VT-15   | Vector(3, 5).multiply(0.5)        | Vector(2, 3)     | 小數乘法並四捨五入 |
| VT-16   | Vector(10, 20).multiply(-1)       | Vector(-10, -20) | 負數乘法（反向）   |
| VT-17   | Vector(10, 20).multiply(NaN)      | 拋出 TypeError   | 參數驗證           |
| VT-18   | Vector(10, 20).multiply(Infinity) | 拋出 RangeError  | 參數驗證           |

### 2.8.5 normalize Operation

| Test ID | Input                     | Expected Output | Accept Criteria        |
| ------- | ------------------------- | --------------- | ---------------------- |
| VT-19   | Vector(3, 4).normalize()  | Vector(1, 1)    | 正規化並四捨五入       |
| VT-20   | Vector(0, 0).normalize()  | Vector(0, 0)    | 零向量正規化返回零向量 |
| VT-21   | Vector(10, 0).normalize() | Vector(1, 0)    | 水平向量正規化         |
| VT-22   | Vector(0, 10).normalize() | Vector(0, 1)    | 垂直向量正規化         |

### 2.8.6 magnitude Operation

| Test ID | Input                      | Expected Output | Accept Criteria |
| ------- | -------------------------- | --------------- | --------------- |
| VT-23   | Vector(3, 4).magnitude()   | 5               | 計算向量長度    |
| VT-24   | Vector(0, 0).magnitude()   | 0               | 零向量長度為 0  |
| VT-25   | Vector(5, 0).magnitude()   | 5               | 水平向量長度    |
| VT-26   | Vector(-3, -4).magnitude() | 5               | 負數座標長度    |

### 2.8.7 distance Operation

| Test ID | Input                                   | Expected Output | Accept Criteria |
| ------- | --------------------------------------- | --------------- | --------------- |
| VT-27   | Vector(0, 0).distance(Vector(3, 4))     | 5               | 計算兩點距離    |
| VT-28   | Vector(10, 10).distance(Vector(10, 10)) | 0               | 相同點距離為 0  |
| VT-29   | Vector(0, 0).distance(Vector(-3, -4))   | 5               | 負數座標距離    |
| VT-30   | Vector(10, 10).distance(null)           | 拋出 TypeError  | 參數驗證        |

### 2.8.8 dot Operation

| Test ID | Input                           | Expected Output | Accept Criteria     |
| ------- | ------------------------------- | --------------- | ------------------- |
| VT-31   | Vector(2, 3).dot(Vector(4, 5))  | 23              | 點積運算（2×4+3×5） |
| VT-32   | Vector(1, 0).dot(Vector(0, 1))  | 0               | 垂直向量點積為 0    |
| VT-33   | Vector(1, 0).dot(Vector(-1, 0)) | -1              | 反向向量點積為負數  |
| VT-34   | Vector(10, 20).dot(undefined)   | 拋出 TypeError  | 參數驗證            |

## 2.9 Entity Tests

### 2.9.1 ID Generation

| Test ID | Input                | Expected Output   | Accept Criteria     |
| ------- | -------------------- | ----------------- | ------------------- |
| ET-01   | 建立第 1 個 Entity   | id = "1"          | ID 為字串格式的整數 |
| ET-02   | 建立第 2 個 Entity   | id = "2"          | ID 自動遞增         |
| ET-03   | 建立 100 個 Entity   | id = "1" 到 "100" | ID 不重複           |
| ET-04   | Entity 建立後修改 id | 編譯錯誤          | id 為 readonly 屬性 |
| ET-05   | 兩個 Entity 的 id    | id 必定不同       | ID 唯一性           |

### 2.9.2 Lifecycle Management

| Test ID | Input                           | Expected Output | Accept Criteria             |
| ------- | ------------------------------- | --------------- | --------------------------- |
| ET-06   | 新建立的 Entity                 | active = true   | 預設為啟用狀態              |
| ET-07   | 設定 active = false             | active = false  | 可停用 Entity               |
| ET-08   | 停用後再設定 active = true      | active = true   | 可重新啟用 Entity           |
| ET-09   | 停用的 Entity（active = false） | 系統應忽略      | 遊戲邏輯不處理停用的 Entity |
| ET-10   | 啟用的 Entity（active = true）  | 系統正常處理    | 遊戲邏輯處理啟用的 Entity   |

### 2.9.3 Object Pool Integration

| Test ID | Input                         | Expected Output            | Accept Criteria    |
| ------- | ----------------------------- | -------------------------- | ------------------ |
| ET-11   | 從物件池取得 Entity（池為空） | 建立新 Entity，分配新 ID   | 自動建立新實體     |
| ET-12   | 從物件池取得 Entity（池非空） | 重用現有 Entity，保留原 ID | 重用物件池內的實體 |
| ET-13   | Entity 返回物件池             | active = false，狀態清除   | 停用並清除狀態     |
| ET-14   | 重新啟用池內 Entity           | active = true，ID 不變     | ID 保持不變        |
| ET-15   | 連續建立/回收 10 次           | ID 總數 ≤ 10               | 物件池有效重用     |

### 2.9.4 Inheritance

| Test ID | Input              | Expected Output      | Accept Criteria  |
| ------- | ------------------ | -------------------- | ---------------- |
| ET-16   | Player 繼承 Entity | Player.id 存在且唯一 | 繼承 Entity 屬性 |
| ET-17   | Ghost 繼承 Entity  | Ghost.id 存在且唯一  | 繼承 Entity 屬性 |
| ET-18   | Boss 繼承 Entity   | Boss.id 存在且唯一   | 繼承 Entity 屬性 |
| ET-19   | Bullet 繼承 Entity | Bullet.id 存在且唯一 | 繼承 Entity 屬性 |
| ET-20   | Food 繼承 Entity   | Food.id 存在且唯一   | 繼承 Entity 屬性 |
| ET-21   | 不同類型的 Entity  | 所有 id 必定不同     | 全域 ID 唯一性   |

## 2.10 Kill Counter and Oyster Omelet Consumption Tests

### 2.10.1 Kill Counter

| Test ID | Input          | Expected Output    | Accept Criteria      |
| ------- | -------------- | ------------------ | -------------------- |
| KC-01   | 擊殺 1 隻餓鬼  | killCount = 1      | 計數器 +1            |
| KC-02   | 擊殺 5 隻餓鬼  | killCount = 5      | 計數器累加正確       |
| KC-03   | 敵人被寶箱消滅 | killCount 不變     | 寶箱消滅不計入擊殺數 |
| KC-04   | 敵人到達底線   | killCount 不變     | 到達底線不計入擊殺數 |
| KC-05   | 跨回合擊殺累計 | killCount 持續累加 | 全局計數器不重置     |

### 2.10.2 Oyster Omelet Consumption

| Test ID | Input                 | Expected Output          | Accept Criteria            |
| ------- | --------------------- | ------------------------ | -------------------------- |
| KC-06   | 遊戲開始，按 5        | 無反應                   | UI 提示擊殺數不足（0/20）  |
| KC-07   | 擊殺 15 隻，按 5      | 無反應                   | UI 提示擊殺數不足（15/20） |
| KC-08   | 擊殺 20 隻，按 5      | 蚵仔煎發射               | 消耗擊殺數 20，剩餘 0      |
| KC-09   | 擊殺 25 隻，按 5      | 蚵仔煎發射               | 消耗擊殺數 20，剩餘 5      |
| KC-10   | 擊殺 40 隻，按 5 兩次 | 第二次蚵仔煎發射         | 可重複消耗，剩餘 0         |
| KC-11   | UI 顯示可用狀態       | 顯示 X/20（可用/不可用） | 實時更新擊殺數和可用狀態   |

### 2.10.3 Quick Eat Effect on Oyster Omelet

| Test ID | Input                         | Expected Output       | Accept Criteria           |
| ------- | ----------------------------- | --------------------- | ------------------------- |
| KC-12   | 選擇「快吃」升級              | 蚵仔煎傷害 +10%       | 傷害增加而非消耗減少      |
| KC-13   | 擊殺 15 隻 + 選「快吃」+ 按 5 | 無反應                | 消耗仍為 20，15<20 不可用 |
| KC-14   | 擊殺 25 隻 + 選「快吃」+ 按 5 | 蚵仔煎發射，傷害 +10% | 消耗 20，傷害增加         |
| KC-15   | 快吃後蚵仔煎 vs Boss          | 造成 20% HP 傷害      | 10% + 10% = 20%           |
| KC-16   | 快吃後蚵仔煎 vs 菁英          | 造成 60% HP 傷害      | 50% + 10% = 60%           |
| KC-17   | 快吃後蚵仔煎 vs 小怪          | 造成 80% HP 傷害      | 70% + 10% = 80%           |

### 2.10.4 Integration Tests

| Test ID | Input                                | Expected Output | Accept Criteria               |
| ------- | ------------------------------------ | --------------- | ----------------------------- |
| KC-18   | 擊殺 20 隻 + 按 5 + 按 Space         | 發射蚵仔煎      | 蚵仔煎效果正確生效            |
| KC-19   | 重新開始遊戲                         | killCount = 0   | 統計重置，擊殺數歸零          |
| KC-20   | 擊殺 19 隻 + 寶箱消滅 1 隻 + 按 5    | 無反應          | 寶箱消滅不計入，仍為 19/20    |
| KC-21   | 結束畫面顯示擊殺數                   | 顯示總擊殺數    | 統計數據正確（含已消耗數量）  |
| KC-22   | 擊殺 25 隻 + 按 5 + 擊殺 3 隻 + 按 5 | 第二次無反應    | 第一次消耗 20，剩 5+3=8，8<20 |

## 2.11 Audio System Tests

### 2.11.1 Initialization

| Test ID | Input                 | Expected Output          | Accept Criteria         |
| ------- | --------------------- | ------------------------ | ----------------------- |
| AS-01   | AudioSystem 初始化    | 系統名稱為 "AudioSystem" | 系統正確註冊            |
| AS-02   | AudioSystem 初始化    | 開始背景預載入音效       | isLoaded() 初始為 false |
| AS-03   | 預載入完成（50ms 後） | isLoaded() 回傳 true     | 所有音效成功載入        |
| AS-04   | 預載入期間播放音效    | 靜默失敗，無錯誤拋出     | 遊戲不受影響            |

### 2.11.2 Volume Control

| Test ID | Input                   | Expected Output             | Accept Criteria        |
| ------- | ----------------------- | --------------------------- | ---------------------- |
| AS-05   | setVolume(0.5)          | getVolume() 回傳 0.5        | 音量設定成功           |
| AS-06   | setVolume(1.5)          | getVolume() 回傳 1.0        | 自動限制上限為 1.0     |
| AS-07   | setVolume(-0.5)         | getVolume() 回傳 0.0        | 自動限制下限為 0.0     |
| AS-08   | setVolume(0.7) 預載入後 | 所有音效 audio.volume = 0.7 | 更新所有已載入音效音量 |

### 2.11.3 Sound Playback

| Test ID | Input                   | Expected Output        | Accept Criteria          |
| ------- | ----------------------- | ---------------------- | ------------------------ |
| AS-09   | 發布 BulletFired 事件   | 播放 player_shoot 音效 | audio.play() 被呼叫      |
| AS-10   | 發布 EnemyHit 事件      | 播放 enemy_hit 音效    | audio.play() 被呼叫      |
| AS-11   | 發布 ButtonClicked 事件 | 播放 button_click 音效 | audio.play() 被呼叫      |
| AS-12   | 連續發布 3 個不同事件   | 3 個音效分別播放       | 所有 audio.play() 被呼叫 |

### 2.11.4 Non-overlapping Playback

| Test ID | Input                       | Expected Output            | Accept Criteria                  |
| ------- | --------------------------- | -------------------------- | -------------------------------- |
| AS-13   | 連續 2 次發布 BulletFired   | 停止前一實例，播放新實例   | audio.pause() 和 currentTime = 0 |
| AS-14   | BulletFired + EnemyHit 同時 | 兩個音效同時播放           | 不同音效 ID 不互相影響           |
| AS-15   | 標記音效為播放中 + 再次播放 | audio.currentTime 重置為 0 | 重新開始播放                     |

### 2.11.5 Error Handling

| Test ID | Input                          | Expected Output       | Accept Criteria       |
| ------- | ------------------------------ | --------------------- | --------------------- |
| AS-16   | 音效載入失敗（error 事件）     | console.warn 記錄錯誤 | isLoaded() 回傳 false |
| AS-17   | 音效載入失敗 + 發布事件        | 不拋出錯誤            | 遊戲繼續執行          |
| AS-18   | play() 被瀏覽器拒絕（Promise） | console.warn 記錄錯誤 | 遊戲繼續執行          |
| AS-19   | 音效尚未載入時播放             | 靜默失敗，無錯誤拋出  | 不影響遊戲流程        |

### 2.11.6 Lifecycle

| Test ID | Input                  | Expected Output           | Accept Criteria    |
| ------- | ---------------------- | ------------------------- | ------------------ |
| AS-20   | destroy() 呼叫         | currentlyPlaying.size = 0 | 停止所有播放中音效 |
| AS-21   | destroy() 呼叫         | sounds.size = 0           | 清空音效緩存       |
| AS-22   | destroy() 呼叫         | isLoaded() 回傳 false     | 重置載入狀態       |
| AS-23   | 播放中音效 + destroy() | audio.pause() 被呼叫      | 確保音效停止       |

### 2.11.7 Integration with EventQueue

| Test ID | Input                       | Expected Output          | Accept Criteria              |
| ------- | --------------------------- | ------------------------ | ---------------------------- |
| AS-24   | 連續發布多個事件            | 所有對應音效播放         | 事件訂閱正常運作             |
| AS-25   | 發布不相關事件（WaveStart） | 不拋出錯誤               | AudioSystem 不受無關事件影響 |
| AS-26   | 依賴注入 EventQueue         | AudioSystem 正確取得依賴 | SystemManager 依賴注入成功   |

## 2.12 Game State Tests

### 2.12.1 Start Screen

| Test ID | Input               | Expected Output | Accept Criteria        |
| ------- | ------------------- | --------------- | ---------------------- |
| GS-01   | 遊戲啟動            | 顯示開始畫面    | 畫面顯示遊戲標題和說明 |
| GS-02   | 開始畫面 + 按 Space | 進入遊戲        | 開始畫面隱藏，遊戲開始 |
| GS-03   | 開始畫面 + 按其他鍵 | 無效果          | 開始畫面仍顯示         |
| GS-04   | 開始畫面顯示        | 遊戲未更新      | 遊戲邏輯暫停           |

### 2.12.2 Game Over Screen

| Test ID | Input                            | Expected Output      | Accept Criteria                |
| ------- | -------------------------------- | -------------------- | ------------------------------ |
| GS-05   | 玩家生命值 = 0                   | 顯示結束畫面         | 畫面顯示統計資料               |
| GS-06   | 結束畫面                         | 顯示存活回合數       | 統計數據正確                   |
| GS-07   | 結束畫面                         | 顯示擊敗敵人總數     | 統計數據正確                   |
| GS-08   | 結束畫面                         | 顯示使用特殊子彈次數 | 統計數據正確（現階段為 0）     |
| GS-09   | 結束畫面 + 按 Space              | 返回開始畫面         | 結束畫面隱藏，開始畫面顯示     |
| GS-10   | 結束畫面 + 按 Space + 再按 Space | 遊戲重新開始         | 玩家生命值恢復，回合數重置為 1 |
| GS-11   | 結束畫面顯示                     | 遊戲未更新           | 遊戲邏輯暫停                   |

### 2.12.3 Game Statistics Tracking

| Test ID | Input         | Expected Output     | Accept Criteria |
| ------- | ------------- | ------------------- | --------------- |
| GS-12   | 完成第 1 回合 | wavesSurvived = 1   | 統計正確記錄    |
| GS-13   | 擊敗 1 隻餓鬼 | enemiesDefeated = 1 | 統計正確記錄    |
| GS-14   | 擊敗 3 隻餓鬼 | enemiesDefeated = 3 | 統計累加正確    |
| GS-15   | 遊戲重新開始  | 所有統計歸零        | 統計重置        |

## 2.13 Player Floating Info Tests

### 2.13.1 Health Display

| Test ID | Input             | Expected Output | Accept Criteria              |
| ------- | ----------------- | --------------- | ---------------------------- |
| PF-01   | 玩家生命值 = 5    | 顯示 ❤❤❤❤❤      | 5 個填滿圖示                 |
| PF-02   | 玩家生命值 = 3    | 顯示 ❤❤❤♡♡      | 3 填滿 + 2 空心              |
| PF-03   | 玩家生命值 = 1    | 顯示 ❤♡♡♡♡      | 1 填滿 + 4 空心              |
| PF-04   | 玩家生命值 5 → 4  | 圖示立即更新    | 最右側填滿變空心             |
| PF-05   | 玩家移動至 (x, y) | 圖示跟隨移動    | 相對位置不變（在角色正下方） |

### 2.13.2 Ammo Progress Bar

| Test ID | Input                 | Expected Output | Accept Criteria              |
| ------- | --------------------- | --------------- | ---------------------------- |
| PF-06   | 彈藥 6/6              | 進度條 100%     | 完全填滿                     |
| PF-07   | 彈藥 3/6              | 進度條 50%      | 填滿一半                     |
| PF-08   | 彈藥 0/6              | 進度條 0%       | 完全空白                     |
| PF-09   | 射擊一次（6/6 → 5/6） | 進度條減少      | 從 100% 變為 83.3%           |
| PF-10   | 玩家移動至 (x, y)     | 進度條跟隨移動  | 相對位置不變（在生命值下方） |

### 2.13.3 Reload Animation

| Test ID | Input                 | Expected Output    | Accept Criteria    |
| ------- | --------------------- | ------------------ | ------------------ |
| PF-11   | 開始重裝（0/6 → 6/6） | 進度條開始動畫填充 | 0% 開始逐漸填滿    |
| PF-12   | 重裝中 1.5 秒         | 進度條約 50%       | 動畫平滑過渡       |
| PF-13   | 重裝完成（3 秒後）    | 進度條 100%        | 動畫結束，完全填滿 |
| PF-14   | 重裝中按 Space        | 無效果，動畫繼續   | 重裝期間無法射擊   |

### 2.13.4 Big Stomach Upgrade Support

| Test ID | Input                 | Expected Output  | Accept Criteria                 |
| ------- | --------------------- | ---------------- | ------------------------------- |
| PF-15   | 大胃王升級（6 → 12）  | 進度條比例更新   | 當前 6/12 顯示為 50%            |
| PF-16   | 彈藥 6/12             | 進度條 50%       | 正確計算比例                    |
| PF-17   | 彈藥 3/12             | 進度條 25%       | 正確計算比例                    |
| PF-18   | 大胃王 3 次（6 → 24） | 彈藥 6/24 = 25%  | 進度條寬度不變，僅比例調整      |
| PF-19   | 大胃王後重裝          | 動畫填滿至新容量 | 3 秒內從 0 填滿至最大容量（24） |

### 2.13.5 Visual Quality

| Test ID | Input                | Expected Output | Accept Criteria        |
| ------- | -------------------- | --------------- | ---------------------- |
| PF-20   | 戰鬥中（多敵人同框） | 圖示清晰可辨    | 不被敵人遮蓋，高對比度 |
| PF-21   | 玩家角色碰撞邊界     | 圖示完整顯示    | 不超出畫面邊界         |
| PF-22   | 60 FPS 測試          | 動畫流暢        | 無卡頓、閃爍           |

# 3. Integration Tests

## 3.1 Gameplay Loop

| Test ID | Scenario               | Steps                                                 | Expected Outcome | Accept Criteria         |
| ------- | ---------------------- | ----------------------------------------------------- | ---------------- | ----------------------- |
| IT-01   | 完整回合               | 1. 擊敗所有敵人<br>2. 拾取食材<br>3. 選擇升級         | 進入第 2 回合    | 回合數 +1               |
| IT-02   | 合成 → 射擊流程        | 1. 按 2, 2, 2 提取豆腐<br>2. 自動合成<br>3. 按 Space  | 發射 2 倍大子彈  | 臭豆腐 Buff 生效        |
| IT-03   | 升級 → 效果生效        | 1. 選擇「加辣」<br>2. 下回合合成臭豆腐<br>3. 射擊敵人 | 傷害 = ×2.5      | 升級效果永久套用        |
| IT-04   | 完整遊戲流程（5 回合） | 1. 完成 5 個回合<br>2. 面對 Boss                      | 存活至回合 5     | Boss 出現，遊戲持續運行 |

## 3.2 System Interactions

| Test ID | System A | System B | Interaction        | Expected Outcome         | Accept Criteria |
| ------- | -------- | -------- | ------------------ | ------------------------ | --------------- |
| IT-05   | 攤位系統 | 合成系統 | 按鍵消耗食材       | 攤位食材 -N，Buff 啟動   | 數據正確傳遞    |
| IT-06   | 戰鬥系統 | 合成系統 | 檢查當前 Buff 狀態 | 返回 Buff 類型和剩餘時間 | Buff 狀態正確   |
| IT-07   | 回合系統 | 升級系統 | 回合結束觸發升級   | 升級系統顯示選項         | 觸發機制正常    |
| IT-08   | 敵人系統 | 寶箱系統 | 敵人碰撞寶箱       | 攤位食材 -1，敵人消失    | 系統間通訊正常  |
| IT-09   | 子彈系統 | Vector   | 追蹤子彈計算方向   | 子彈正確朝向敵人移動     | Vector 運算正確 |
| IT-10   | 碰撞系統 | Vector   | 碰撞距離檢測       | 正確判斷碰撞範圍         | 距離計算正確    |
| IT-11   | 散射系統 | Vector   | 散射子彈方向生成   | 生成多個不同方向的子彈   | 向量運算正確    |

# 4. Acceptance Tests

## 4.1 User Stories

| Test ID | User Story            | Scenario                                                                               | Expected Result      | Accept Criteria          |
| ------- | --------------------- | -------------------------------------------------------------------------------------- | -------------------- | ------------------------ |
| AT-01   | 新手玩家第一次遊玩    | 1. 按 Space 射擊餓鬼<br>2. 珍珠自動進入攤位<br>3. 按 1 提取珍珠合成<br>4. 發射特殊子彈 | 特殊子彈擊中多隻敵人 | 遊戲機制直觀易懂         |
| AT-02   | 進階玩家存活 10 回合  | 1. 完成 10 個回合<br>2. 策略性使用升級和合成                                           | 玩家仍有生命值       | 第 10 回合生成 21 隻敵人 |
| AT-03   | Boss 回合使用夜市總匯 | 1. 第 5 回合開始<br>2. 合成夜市總匯<br>3. 射擊 Boss                                    | 閃電連鎖擊中所有敵人 | 夜市總匯效果正確         |

## 4.2 Game End Conditions

| Test ID | Condition      | Input                   | Expected Output        | Accept Criteria                        |
| ------- | -------------- | ----------------------- | ---------------------- | -------------------------------------- |
| AT-04   | 玩家生命值歸零 | 生命 1 + 敵人到達底線   | 遊戲暫停，顯示結算畫面 | 顯示存活回合數、擊敗敵人數             |
| AT-05   | 遊戲結束統計   | 遊戲結束畫面            | 顯示統計資訊           | 存活回合數、擊敗敵人、使用特殊子彈次數 |
| AT-06   | 重新開始       | 結算畫面 + 選擇重新開始 | 回到第 1 回合          | 所有狀態重置                           |

# 5. Performance Tests

## 5.1 Frame Rate

| Test ID | Scenario                       | Load Condition     | Expected FPS | Accept Criteria  |
| ------- | ------------------------------ | ------------------ | ------------ | ---------------- |
| PT-01   | 50 隻敵人同時存在              | 第 25 回合         | ≥ 55 FPS     | 平均幀率穩定     |
| PT-02   | 100 發子彈同時存在             | 散射類子彈大量發射 | ≥ 55 FPS     | 平均幀率穩定     |
| PT-03   | 複雜場景（50 敵人 + 100 子彈） | 極限測試           | ≥ 50 FPS     | 可接受的效能下限 |

## 5.2 Memory Usage

| Test ID | Scenario     | Duration       | Expected Memory Usage | Accept Criteria |
| ------- | ------------ | -------------- | --------------------- | --------------- |
| PT-04   | 長時間遊戲   | 30 分鐘        | 記憶體增長 < 50 MB    | 無記憶體洩漏    |
| PT-05   | 多次重新開始 | 重新開始 10 次 | 記憶體穩定            | 資源正確釋放    |

# 6. Browser Compatibility Tests

## 6.1 Cross-Browser

| Test ID | Browser | Version | Expected Result | Accept Criteria |
| ------- | ------- | ------- | --------------- | --------------- |
| BC-01   | Chrome  | 120+    | 所有功能正常    | 無錯誤，60 FPS  |
| BC-02   | Firefox | 120+    | 所有功能正常    | 無錯誤，60 FPS  |
| BC-03   | Safari  | 17+     | 所有功能正常    | 無錯誤，60 FPS  |
| BC-04   | Edge    | 120+    | 所有功能正常    | 無錯誤，60 FPS  |

# 7. Manual Testing Checklist

## 7.1 Visual Quality

- [ ] 攤位區域正確顯示在左側 20%
- [ ] HUD 不遮蓋遊戲活動區域
- [ ] 敵人生成和移動動畫流暢
- [ ] 子彈發射方向正確（向右）
- [ ] 食材掉落位置合理（敵人死亡處）
- [ ] 特殊子彈效果可視化清晰
- [ ] Pixi.js Sprite 渲染正確
- [ ] 碰撞箱大小視覺化準確

### 7.1.1 Bullet Visual Effects Checklist

**普通子彈**:

- [ ] 白色風切線條尾跡可見且不過於顯眼
- [ ] 命中敵人產生白色 Pop 特效
- [ ] 特效簡潔，不搶特殊子彈風采

**夜市總匯**:

- [ ] 飛行時金黃色電流環繞效果明顯
- [ ] 命中後金黃色閃電鏈正確跳躍至最近 4 個敵人
- [ ] 被鏈結敵人短暫閃爍金光
- [ ] 連鎖視覺效果流暢，無卡頓

**臭豆腐**:

- [ ] 綠色氣體尾跡呈波浪狀
- [ ] 貫穿敵人時子彈不停頓
- [ ] 穿過敵人背後爆出綠色臭氣特效
- [ ] 綠色效果易於識別「臭豆腐」

**珍珠奶茶**:

- [ ] 發射瞬間同時生成三顆子彈
- [ ] 子彈呈扇形散射，角度合理
- [ ] 子彈視覺尺寸比普通子彈大
- [ ] 散射覆蓋範圍視覺滿足感強

**豬血糕**:

- [ ] 子彈軌跡呈曲線或螺旋狀
- [ ] 追蹤最近敵人行為明顯
- [ ] 尾部黑色黏稠殘影效果清晰
- [ ] 黏膩感視覺呼應緩速效果

**蚵仔煎**:

- [ ] 投擲物體積比普通子彈大 3-4 倍
- [ ] 拋物線軌跡動畫流暢
- [ ] 命中時螢幕震動效果明顯但不過度
- [ ] 大招視覺呈現重量感和毀滅性

**整體評估**:

- [ ] 5 種特殊子彈視覺差異明顯，易於快速識別
- [ ] 所有視覺效果不影響遊戲 FPS（≥55 FPS）
- [ ] 特效不遮蓋重要遊戲資訊（敵人位置、玩家狀態）
- [ ] 打擊感明確，命中反饋即時

## 7.2 Audio Quality

- [ ] 射擊音效正確觸發
- [ ] 敵人死亡音效播放
- [ ] 合成成功音效提示
- [ ] 背景音樂循環播放
- [ ] Boss 出現特殊音效

## 7.3 User Experience

- [ ] 鍵盤操作反應靈敏（延遲 < 100ms）
- [ ] 升級選項說明易懂
- [ ] 遊戲結束畫面統計準確
- [ ] 重新開始功能正常
- [ ] 載入時間 < 3 秒

# 8. Continuous Integration

## 8.1 CI Pipeline

1. **Lint**：程式碼風格檢查（Prettier + ESLint）
2. **Type Check**：TypeScript 型別檢查
3. **Unit Tests**：單元測試（Vitest）
4. **Integration Tests**：整合測試
5. **Build**：編譯打包（Vite）
6. **Deploy Preview**：部署預覽環境（Cloudflare Pages）

## 8.2 Quality Gates

| Gate            | Requirement | Accept Criteria  |
| --------------- | ----------- | ---------------- |
| 測試通過率      | 100%        | 所有測試必須通過 |
| 程式碼覆蓋率    | ≥ 80%       | 總體覆蓋率達標   |
| TypeScript 錯誤 | 0           | 無型別錯誤       |
| Lint 錯誤       | 0           | 無程式碼風格錯誤 |
| 建置成功        | ✓           | 建置無錯誤       |
