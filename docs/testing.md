# Testing Specification

本文件定義驗證 `SPEC.md` 需求的測試案例。

# 1. Testing Strategy

## 1.1 Test Levels

1. **單元測試（Unit Tests）**：測試個別系統和元件
2. **整合測試（Integration Tests）**：測試系統間互動
3. **驗收測試（Acceptance Tests）**：測試完整遊戲流程

## 1.2 Test Framework

- **框架**：Vitest
- **覆蓋率目標**：80% 以上
- **執行方式**：`npm test`

## 1.3 Test Coverage Goals

| 類別     | 目標覆蓋率 |
| -------- | ---------- |
| 核心系統 | 90%        |
| 遊戲實體 | 85%        |
| UI 元件  | 70%        |
| 整合流程 | 80%        |
| **總體** | **80%**    |

# 2. Unit Tests

## 2.1 Booth System Tests

### 2.1.1 Store Food

| Test ID | Input                        | Expected Output | Accept Criteria            |
| ------- | ---------------------------- | --------------- | -------------------------- |
| BS-01   | 空攤位 + 儲存珍珠            | 攤位數量 = 1    | 攤位顯示珍珠 ×1            |
| BS-02   | 攤位 5/6 + 儲存珍珠          | 攤位數量 = 6    | 攤位顯示珍珠 ×6            |
| BS-03   | 攤位 6/6 + 儲存珍珠          | 攤位數量 = 6    | 食材消失，攤位仍為 6/6     |
| BS-04   | 珍珠攤位 + 儲存豆腐          | 儲存失敗        | 豆腐不進入珍珠攤位         |
| BS-05   | 攤位 0/6 + 連續儲存 3 個食材 | 攤位數量 = 3    | 攤位顯示食材 ×3            |
| BS-06   | 3 種攤位同時儲存不同食材     | 各攤位數量 = 1  | 每種食材進入對應攤位       |
| BS-07   | 敵人死亡掉落珍珠             | 攤位數量 = 1    | 食材自動進入攤位，珍珠 +1  |
| BS-08   | 攤位 6/6 + 敵人死亡掉落珍珠  | 攤位數量 = 6    | 食材消失（丟失），攤位不變 |

### 2.1.2 Retrieve Food

| Test ID | Input             | Expected Output       | Accept Criteria            |
| ------- | ----------------- | --------------------- | -------------------------- |
| BS-09   | 攤位 3/6 + 按 1   | 攤位 2/6，合成槽 1/3  | 珍珠從攤位移動到合成槽     |
| BS-10   | 攤位 0/6 + 按 1   | 無效果                | 攤位仍為 0/6，合成槽無變化 |
| BS-11   | 合成槽 3/3 + 按 1 | 無效果                | 攤位無變化，合成槽仍為 3/3 |
| BS-12   | 攤位 1/6 + 按 1   | 攤位 0/6，合成槽 1/3  | 提取最後 1 個食材          |
| BS-13   | 連續按 1, 2, 3    | 合成槽 3/3（各 1 個） | 3 種食材進入合成槽         |
| BS-14   | 攤位 6/6 + 按 1   | 攤位 5/6，合成槽 1/3  | 攤位有空位後可再儲存       |

### 2.1.3 Enemy Steal

| Test ID | Input               | Expected Output | Accept Criteria  |
| ------- | ------------------- | --------------- | ---------------- |
| BS-15   | 攤位 3/6 + 敵人觸碰 | 攤位 2/6        | 攤位食材 -1      |
| BS-16   | 攤位 0/6 + 敵人觸碰 | 攤位 0/6        | 無效果           |
| BS-17   | 攤位 6/6 + 敵人觸碰 | 攤位 5/6        | 攤位食材 -1      |
| BS-18   | 敵人觸碰後繼續移動  | 敵人向左移動    | 敵人不停留在攤位 |

## 2.2 Combat System Tests

### 2.2.1 Normal Attack

| Test ID | Input                 | Expected Output        | Accept Criteria    |
| ------- | --------------------- | ---------------------- | ------------------ |
| CS-01   | 彈夾 6/6 + 按 Space   | 彈夾 5/6，子彈生成     | 子彈向右飛行       |
| CS-02   | 彈夾 0/6 + 按 Space   | 無效果                 | 不發射子彈         |
| CS-03   | 子彈擊中餓鬼（1 HP）  | 餓鬼死亡               | 餓鬼消失，掉落食材 |
| CS-04   | 子彈擊中 Boss（3 HP） | Boss 生命 2 HP         | Boss 扣 1 HP       |
| CS-05   | 連續按 Space 6 次     | 彈夾 0/6，6 發子彈生成 | 彈夾歸零           |
| CS-06   | 子彈飛出畫面右邊界    | 子彈消失               | 子彈離開畫面後銷毀 |
| CS-07   | 子彈未擊中任何敵人    | 子彈繼續飛行           | 子彈直到飛出畫面   |

### 2.2.2 Reload

| Test ID | Input                      | Expected Output    | Accept Criteria |
| ------- | -------------------------- | ------------------ | --------------- |
| CS-08   | 彈夾 0/6 + 等待 3 秒       | 彈夾 6/6           | 彈夾恢復滿載    |
| CS-09   | 重裝中（1.5 秒）+ 按 Space | 無效果             | 不發射子彈      |
| CS-10   | 重裝中 + 按 WASD           | 玩家移動           | 玩家正常移動    |
| CS-11   | 彈夾 0/6 + 等待 1.5 秒     | 彈夾 0/6           | 重裝未完成      |
| CS-12   | 重裝完成瞬間 + 按 Space    | 彈夾 5/6，子彈生成 | 可正常射擊      |

### 2.2.3 Special Bullet

| Test ID | Input                           | Expected Output                | Accept Criteria            |
| ------- | ------------------------------- | ------------------------------ | -------------------------- |
| CS-13   | 火力強化 Buff + 按 Space        | 傷害 ×8 子彈                   | 擊殺 8 HP 敵人或 8 隻餓鬼  |
| CS-14   | 臭豆腐 Buff + 按 Space          | 貫穿子彈                       | 子彈擊中敵人不消失         |
| CS-15   | 珍珠奶茶 Buff + 按 Space        | 散射多個子彈                   | 同時發射多發子彈           |
| CS-16   | 豬血糕 Buff + 按 Space          | 追蹤子彈                       | 子彈自動追蹤敵人           |
| CS-17   | 夜市總匯 Buff + 擊中第 1 隻敵人 | 閃電連鎖至下一隻敵人，傷害 ×10 | 閃電連鎖直到螢幕外或無敵人 |
| CS-18   | Buff 結束（2 秒後）+ 按 Space   | 普通子彈                       | 子彈恢復正常               |
| CS-19   | 特殊 Buff 期間 + 按數字鍵       | 無效果                         | 無法再次合成               |
| CS-20   | Buff 剩餘 0.5 秒 + 按 Space     | 特殊子彈                       | Buff 期間仍有效            |

## 2.3 Synthesis System Tests

### 2.3.1 Decision Table: Synthesis Recipes

| Test ID | 珍珠 | 豆腐 | 米血 | 按鍵 | Expected Recipe | Buff Duration | Accept Criteria                                                                  |
| ------- | ---- | ---- | ---- | ---- | --------------- | ------------- | -------------------------------------------------------------------------------- |
| SY-01   | 3    | 0    | 0    | 3    | 珍珠奶茶        | 2s            | 散射                                                                             |
| SY-02   | 0    | 3    | 0    | 2    | 臭豆腐          | 2s            | 貫穿                                                                             |
| SY-03   | 0    | 0    | 3    | 4    | 豬血糕          | 2s            | 追蹤彈                                                                           |
| SY-04   | 2    | 1    | 0    | 3    | 珍珠奶茶        | 2s            | 散射（剩餘珍珠2）                                                                |
| SY-05   | 1    | 2    | 0    | 2    | 臭豆腐          | 2s            | 貫穿（剩餘豆腐2）                                                                |
| SY-06   | 2    | 0    | 1    | 3    | 珍珠奶茶        | 2s            | 散射（剩餘珍珠2）                                                                |
| SY-07   | 1    | 0    | 2    | 4    | 豬血糕          | 2s            | 追蹤彈（剩餘米血2）                                                              |
| SY-08   | 0    | 2    | 1    | 2    | 臭豆腐          | 2s            | 貫穿（剩餘豆腐2）                                                                |
| SY-09   | 0    | 1    | 2    | 4    | 豬血糕          | 2s            | 追蹤彈（剩餘米血2）                                                              |
| SY-10   | 1    | 1    | 1    | 1    | 夜市總匯        | 2s            | 發射閃電追蹤子彈，打到敵人後自動找下一位敵人攻擊，子彈在螢幕外消失，基礎傷害 ×10 |
| SY-11   | 0    | 0    | 0    | 5    | 蚵仔煎          | 2s            | 基礎傷害 ×8，消耗擊殺數 ×10                                                      |

### 2.3.2 Trigger Special Bullets

| Test ID | Input                 | Expected Output    | Accept Criteria       |
| ------- | --------------------- | ------------------ | --------------------- |
| SY-12   | 按 1（夜市總匯）        | Buff 啟動 2s       | 消耗豆腐1珍珠1米血1            |
| SY-13   | 按 2（臭豆腐）          | Buff 啟動 2s       | 消耗豆腐3                      |
| SY-14   | 按 3（珍珠奶茶）        | Buff 啟動 2s       | 消耗珍珠3                      |
| SY-15   | 按 4（豬血糕）          | Buff 啟動 2s       | 消耗米血3                      |
| SY-16   | 按 5（蚵仔煎），擊殺數≥10  | Buff 啟動 2s       | 消耗擊殺數 10，擊殺數 -10      |
| SY-17   | 按 5（蚵仔煎），擊殺數<10  | 無反應             | UI 提示擊殺數不足              |
| SY-18   | 按 1，食材不足          | 無反應             | UI 提示庫存不足                |
| SY-19   | Buff 期間按 1           | 無反應             | 無法疊加 Buff                  |
| SY-20   | Buff 結束後按 5，擊殺數≥10 | Buff 啟動 2s       | 蚵仔煎可重複使用，再次消耗 10  |
| SY-21   | 選「打折」後按 2        | 消耗豆腐2          | 打折效果永久生效               |
| SY-22   | 選「快吃」後按 2        | 消耗豆腐2          | 快吃效果當場生效               |
| SY-23   | 打折+快吃後按 2         | 消耗豆腐1（最低1） | 兩種效果疊加（最低1）          |
| SY-24   | 擊殺 7 隻 + 選「快吃」+ 按 5  | Buff 啟動 2s       | 消耗從 10→5，7≥5 可觸發，擊殺數 -5 |
| SY-25   | 擊殺 4 隻 + 選「快吃」+ 按 5  | 無反應             | 消耗從 10→5，4<5 不可觸發      |

## 2.4 Upgrade System Tests

### 2.4.1 Decision Table: Upgrade Availability

| Test ID | 豆腐庫存 | 珍珠庫存 | 米血庫存 | 升級選項 | Available | Accept Criteria     |
| ------- | -------- | -------- | -------- | -------- | --------- | ------------------- |
| UP-01   | 0        | 0        | 0        | 加辣     | ✓         | 無消耗，總是可選擇  |
| UP-02   | 0        | 0        | 0        | 加椰果   | ✓         | 無消耗，總是可選擇  |
| UP-03   | 0        | 0        | 0        | 加香菜   | ✓         | 無消耗，總是可選擇  |
| UP-04   | 6        | 6        | 6        | 任一     | ✓         | 無消耗，總是可選擇  |
| UP-05   | 0        | 0        | 0        | 打折     | ✓         | Boss升級，總是可選  |
| UP-06   | 0        | 0        | 0        | 大胃王   | ✓         | Boss升級，總是可選  |
| UP-07   | 0        | 0        | 0        | 快吃     | ✓         | Boss升級，總是可選  |
| UP-08   | 0        | 0        | 0        | 飢餓三十 | ✓         | Boss升級，總是可選  |

### 2.4.2 Present Options

| Test ID | Input        | Expected Output    | Accept Criteria |
| ------- | ------------ | ------------------ | --------------- |
| UP-09   | 回合結束     | 顯示 2 個升級選項  | 隨機抽取        |
| UP-10   | 多次回合結束 | 選項組合不全相同   | 隨機性          |
| UP-11   | 升級選項顯示 | 包含效果和消耗說明 | UI 顯示完整資訊 |

### 2.4.3 Apply Upgrade

| Test ID | Input                      | Expected Output                 | Accept Criteria  |
| ------- | -------------------------- | ------------------------------- | ---------------- |
| UP-12   | 選擇「加辣」               | 臭豆腐傷害倍率 +0.5             | 無消耗，效果套用 |
| UP-13   | 已選「加辣」+ 再選「加辣」 | 臭豆腐傷害倍率再 +0.5           | 效果堆疊         |
| UP-14   | 第 2 回合選「加辣」        | 第 5 回合臭豆腐傷害倍率仍 +0.5  | 永久效果         |
| UP-15   | 未選擇任何選項             | 無法進入下一回合                | 必須選擇升級     |
| UP-16   | 選擇升級後                 | 進入下一回合                    | 回合數 +1        |
| UP-17   | 選擇「打折」               | 特殊子彈消耗 -1（永久，最低 1） | Boss升級效果套用 |
| UP-18   | 選擇「快吃」               | 特殊子彈消耗 -1（當場，最低 1） | 當場生效         |
| UP-19   | 打折 + 快吃                | 消耗減少效果疊加（最低 1）      | 兩種效果可疊加   |

## 2.5 Wave System Tests

### 2.5.1 Decision Table: Enemy Spawning

| Test ID | 回合數 | 一般敵人數 | Boss 數 | 總敵人數 | Accept Criteria      |
| ------- | ------ | ---------- | ------- | -------- | -------------------- |
| WS-01   | 1      | 2          | 0       | 2        | 公式：回合數 × 2     |
| WS-02   | 2      | 4          | 0       | 4        | 公式：回合數 × 2     |
| WS-03   | 5      | 10         | 1       | 11       | Boss 每 5 回合出現   |
| WS-04   | 10     | 20         | 1       | 21       | Boss 每 5 回合出現   |
| WS-05   | 15     | 30         | 1       | 31       | Boss 每 5 回合出現   |
| WS-06   | 6      | 12         | 0       | 12       | 非 5 倍數回合無 Boss |
| WS-07   | 25     | 50         | 1       | 51       | 最大敵人數測試       |

### 2.5.2 Wave Progression

| Test ID | Input             | Expected Output | Accept Criteria        |
| ------- | ----------------- | --------------- | ---------------------- |
| WS-08   | 擊敗最後 1 隻敵人 | 觸發升級畫面    | 回合結束               |
| WS-09   | 升級完成          | 進入下一回合    | 回合數 +1，生成新敵人  |
| WS-10   | 玩家生命值 = 0    | 遊戲結束        | 不進入下一回合         |
| WS-11   | 所有敵人到達底線  | 觸發升級畫面    | 敵人清空（即使未擊殺） |

## 2.6 Player Tests

### 2.6.1 Movement

| Test ID | Input                       | Expected Output  | Accept Criteria |
| ------- | --------------------------- | ---------------- | --------------- |
| PL-01   | 玩家 (500, 500) + 按 W 1 秒 | 玩家 (500, 300)  | 向上移動 200 px |
| PL-02   | 玩家 (500, 500) + 按 A 1 秒 | 玩家 (300, 500)  | 向左移動 200 px |
| PL-03   | 玩家 (500, 500) + 按 S 1 秒 | 玩家 (500, 700)  | 向下移動 200 px |
| PL-04   | 玩家 (500, 500) + 按 D 1 秒 | 玩家 (700, 500)  | 向右移動 200 px |
| PL-05   | 玩家 (384, 500) + 按 A      | 玩家 (384, 500)  | 碰到左邊界停止  |
| PL-06   | 玩家 (1920, 500) + 按 D     | 玩家 (1920, 500) | 碰到右邊界停止  |
| PL-07   | 玩家 (500, 0) + 按 W        | 玩家 (500, 0)    | 碰到上邊界停止  |
| PL-08   | 玩家 (500, 1080) + 按 S     | 玩家 (500, 1080) | 碰到下邊界停止  |
| PL-09   | 同時按 W + D                | 玩家向右上移動   | 對角線移動      |

### 2.6.2 Collision

| Test ID | Input                                 | Expected Output | Accept Criteria   |
| ------- | ------------------------------------- | --------------- | ----------------- |
| PL-10   | 玩家中心 (500, 500) + 敵人 (512, 500) | 無碰撞          | 距離 > 24，無效果 |
| PL-11   | 玩家中心 (500, 500) + 敵人 (510, 500) | 無碰撞（穿透）  | 玩家不受傷        |
| PL-12   | 碰撞箱測試                            | 24×24 px        | 碰撞箱大小正確    |

### 2.6.3 Health

| Test ID | Input                 | Expected Output  | Accept Criteria  |
| ------- | --------------------- | ---------------- | ---------------- |
| PL-13   | 生命 5 + 敵人到達底線 | 生命 4           | 扣 1 條生命      |
| PL-14   | 生命 1 + 敵人到達底線 | 生命 0，遊戲結束 | 觸發遊戲結束畫面 |
| PL-15   | 遊戲結束畫面          | 顯示存活回合數   | 統計資訊正確     |

## 2.7 Enemy Tests

### 2.7.1 Ghost (餓鬼)

| Test ID | Input                    | Expected Output       | Accept Criteria    |
| ------- | ------------------------ | --------------------- | ------------------ |
| EN-01   | 餓鬼 (1000, 500) + 1 秒  | 餓鬼 (950, 500)       | 向左移動 50 px     |
| EN-02   | 餓鬼 1 HP + 普通子彈擊中 | 餓鬼死亡              | 餓鬼消失           |
| EN-03   | 餓鬼死亡                 | 掉落隨機食材          | 珍珠/豆腐/米血其一 |
| EN-04   | 餓鬼死亡位置 (500, 500)  | 食材生成 (500, 500)   | 食材在死亡位置     |
| EN-05   | 餓鬼到達 x = 384         | 玩家生命 -1，餓鬼消失 | 到達底線           |

### 2.7.2 Boss (餓死鬼)

| Test ID | Input                    | Expected Output        | Accept Criteria    |
| ------- | ------------------------ | ---------------------- | ------------------ |
| EN-06   | Boss (1000, 500) + 1 秒  | Boss (970, 500)        | 向左移動 30 px     |
| EN-07   | Boss 3 HP + 普通子彈擊中 | Boss 2 HP              | 扣 1 HP            |
| EN-08   | Boss 3 HP + 3 發普通子彈 | Boss 死亡              | 3 次攻擊擊殺       |
| EN-09   | Boss 到達 x = 384        | 玩家生命 -1，Boss 消失 | 到達底線           |
| EN-10   | Boss 死亡                | 掉落隨機食材           | 珍珠/豆腐/米血其一 |

### 2.7.3 Booth Interaction

| Test ID | Input               | Expected Output  | Accept Criteria |
| ------- | ------------------- | ---------------- | --------------- |
| EN-11   | 攤位 3/6 + 敵人觸碰 | 攤位 2/6         | 偷取 1 個食材   |
| EN-12   | 敵人偷取後          | 敵人繼續向左移動 | 不停留在攤位    |
| EN-13   | 攤位 0/6 + 敵人觸碰 | 攤位 0/6         | 無食材可偷      |

## 2.8 Vector Tests

### 2.8.1 Construction and Properties

| Test ID | Input              | Expected Output | Accept Criteria    |
| ------- | ------------------ | --------------- | ------------------ |
| VT-01   | Vector(10, 20)     | x=10, y=20      | 正確建立向量       |
| VT-02   | Vector(10.7, 20.3) | x=11, y=20      | 座標四捨五入為整數 |
| VT-03   | Vector(-5, -10)    | x=-5, y=-10     | 支援負數座標       |
| VT-04   | Vector(0, 0)       | x=0, y=0        | 零向量             |

### 2.8.2 add Operation

| Test ID | Input                             | Expected Output | Accept Criteria |
| ------- | --------------------------------- | --------------- | --------------- |
| VT-05   | Vector(10, 20).add(Vector(5, 3))  | Vector(15, 23)  | 向量加法        |
| VT-06   | Vector(10, 20).add(Vector(-5, 3)) | Vector(5, 23)   | 負數加法        |
| VT-07   | Vector(0, 0).add(Vector(5, 3))    | Vector(5, 3)    | 零向量加法      |
| VT-08   | Vector(10, 20).add(null)          | 拋出 TypeError  | 參數驗證        |

### 2.8.3 subtract Operation

| Test ID | Input                                   | Expected Output | Accept Criteria |
| ------- | --------------------------------------- | --------------- | --------------- |
| VT-09   | Vector(10, 20).subtract(Vector(5, 3))   | Vector(5, 17)   | 向量減法        |
| VT-10   | Vector(10, 20).subtract(Vector(15, 25)) | Vector(-5, -5)  | 結果為負數      |
| VT-11   | Vector(10, 20).subtract(Vector(10, 20)) | Vector(0, 0)    | 結果為零向量    |
| VT-12   | Vector(10, 20).subtract(undefined)      | 拋出 TypeError  | 參數驗證        |

### 2.8.4 multiply Operation

| Test ID | Input                             | Expected Output  | Accept Criteria    |
| ------- | --------------------------------- | ---------------- | ------------------ |
| VT-13   | Vector(10, 20).multiply(2)        | Vector(20, 40)   | 純量乘法           |
| VT-14   | Vector(10, 20).multiply(0)        | Vector(0, 0)     | 乘以 0 返回零向量  |
| VT-15   | Vector(3, 5).multiply(0.5)        | Vector(2, 3)     | 小數乘法並四捨五入 |
| VT-16   | Vector(10, 20).multiply(-1)       | Vector(-10, -20) | 負數乘法（反向）   |
| VT-17   | Vector(10, 20).multiply(NaN)      | 拋出 TypeError   | 參數驗證           |
| VT-18   | Vector(10, 20).multiply(Infinity) | 拋出 RangeError  | 參數驗證           |

### 2.8.5 normalize Operation

| Test ID | Input                     | Expected Output | Accept Criteria        |
| ------- | ------------------------- | --------------- | ---------------------- |
| VT-19   | Vector(3, 4).normalize()  | Vector(1, 1)    | 正規化並四捨五入       |
| VT-20   | Vector(0, 0).normalize()  | Vector(0, 0)    | 零向量正規化返回零向量 |
| VT-21   | Vector(10, 0).normalize() | Vector(1, 0)    | 水平向量正規化         |
| VT-22   | Vector(0, 10).normalize() | Vector(0, 1)    | 垂直向量正規化         |

### 2.8.6 magnitude Operation

| Test ID | Input                      | Expected Output | Accept Criteria |
| ------- | -------------------------- | --------------- | --------------- |
| VT-23   | Vector(3, 4).magnitude()   | 5               | 計算向量長度    |
| VT-24   | Vector(0, 0).magnitude()   | 0               | 零向量長度為 0  |
| VT-25   | Vector(5, 0).magnitude()   | 5               | 水平向量長度    |
| VT-26   | Vector(-3, -4).magnitude() | 5               | 負數座標長度    |

### 2.8.7 distance Operation

| Test ID | Input                                   | Expected Output | Accept Criteria |
| ------- | --------------------------------------- | --------------- | --------------- |
| VT-27   | Vector(0, 0).distance(Vector(3, 4))     | 5               | 計算兩點距離    |
| VT-28   | Vector(10, 10).distance(Vector(10, 10)) | 0               | 相同點距離為 0  |
| VT-29   | Vector(0, 0).distance(Vector(-3, -4))   | 5               | 負數座標距離    |
| VT-30   | Vector(10, 10).distance(null)           | 拋出 TypeError  | 參數驗證        |

### 2.8.8 dot Operation

| Test ID | Input                           | Expected Output | Accept Criteria     |
| ------- | ------------------------------- | --------------- | ------------------- |
| VT-31   | Vector(2, 3).dot(Vector(4, 5))  | 23              | 點積運算（2×4+3×5） |
| VT-32   | Vector(1, 0).dot(Vector(0, 1))  | 0               | 垂直向量點積為 0    |
| VT-33   | Vector(1, 0).dot(Vector(-1, 0)) | -1              | 反向向量點積為負數  |
| VT-34   | Vector(10, 20).dot(undefined)   | 拋出 TypeError  | 參數驗證            |

## 2.9 Entity Tests

### 2.9.1 ID Generation

| Test ID | Input                | Expected Output   | Accept Criteria     |
| ------- | -------------------- | ----------------- | ------------------- |
| ET-01   | 建立第 1 個 Entity   | id = "1"          | ID 為字串格式的整數 |
| ET-02   | 建立第 2 個 Entity   | id = "2"          | ID 自動遞增         |
| ET-03   | 建立 100 個 Entity   | id = "1" 到 "100" | ID 不重複           |
| ET-04   | Entity 建立後修改 id | 編譯錯誤          | id 為 readonly 屬性 |
| ET-05   | 兩個 Entity 的 id    | id 必定不同       | ID 唯一性           |

### 2.9.2 Lifecycle Management

| Test ID | Input                           | Expected Output | Accept Criteria             |
| ------- | ------------------------------- | --------------- | --------------------------- |
| ET-06   | 新建立的 Entity                 | active = true   | 預設為啟用狀態              |
| ET-07   | 設定 active = false             | active = false  | 可停用 Entity               |
| ET-08   | 停用後再設定 active = true      | active = true   | 可重新啟用 Entity           |
| ET-09   | 停用的 Entity（active = false） | 系統應忽略      | 遊戲邏輯不處理停用的 Entity |
| ET-10   | 啟用的 Entity（active = true）  | 系統正常處理    | 遊戲邏輯處理啟用的 Entity   |

### 2.9.3 Object Pool Integration

| Test ID | Input                         | Expected Output            | Accept Criteria    |
| ------- | ----------------------------- | -------------------------- | ------------------ |
| ET-11   | 從物件池取得 Entity（池為空） | 建立新 Entity，分配新 ID   | 自動建立新實體     |
| ET-12   | 從物件池取得 Entity（池非空） | 重用現有 Entity，保留原 ID | 重用物件池內的實體 |
| ET-13   | Entity 返回物件池             | active = false，狀態清除   | 停用並清除狀態     |
| ET-14   | 重新啟用池內 Entity           | active = true，ID 不變     | ID 保持不變        |
| ET-15   | 連續建立/回收 10 次           | ID 總數 ≤ 10               | 物件池有效重用     |

### 2.9.4 Inheritance

| Test ID | Input              | Expected Output      | Accept Criteria  |
| ------- | ------------------ | -------------------- | ---------------- |
| ET-16   | Player 繼承 Entity | Player.id 存在且唯一 | 繼承 Entity 屬性 |
| ET-17   | Ghost 繼承 Entity  | Ghost.id 存在且唯一  | 繼承 Entity 屬性 |
| ET-18   | Boss 繼承 Entity   | Boss.id 存在且唯一   | 繼承 Entity 屬性 |
| ET-19   | Bullet 繼承 Entity | Bullet.id 存在且唯一 | 繼承 Entity 屬性 |
| ET-20   | Food 繼承 Entity   | Food.id 存在且唯一   | 繼承 Entity 屬性 |
| ET-21   | 不同類型的 Entity  | 所有 id 必定不同     | 全域 ID 唯一性   |

## 2.10 Kill Counter and Oyster Omelet Consumption Tests

### 2.10.1 Kill Counter

| Test ID | Input                      | Expected Output     | Accept Criteria           |
| ------- | -------------------------- | ------------------- | ------------------------- |
| KC-01   | 擊殺 1 隻餓鬼              | killCount = 1       | 計數器 +1                 |
| KC-02   | 擊殺 5 隻餓鬼              | killCount = 5       | 計數器累加正確            |
| KC-03   | 敵人被寶箱消滅             | killCount 不變      | 寶箱消滅不計入擊殺數      |
| KC-04   | 敵人到達底線               | killCount 不變      | 到達底線不計入擊殺數      |
| KC-05   | 跨回合擊殺累計             | killCount 持續累加  | 全局計數器不重置          |

### 2.10.2 Oyster Omelet Consumption

| Test ID | Input                          | Expected Output            | Accept Criteria                     |
| ------- | ------------------------------ | -------------------------- | ----------------------------------- |
| KC-06   | 遊戲開始，按 5                 | 無反應                     | UI 提示擊殺數不足（0/10）           |
| KC-07   | 擊殺 5 隻，按 5                | 無反應                     | UI 提示擊殺數不足（5/10）           |
| KC-08   | 擊殺 10 隻，按 5               | Buff 啟動 2s               | 消耗擊殺數 10，剩餘 0               |
| KC-09   | 擊殺 15 隻，按 5               | Buff 啟動 2s               | 消耗擊殺數 10，剩餘 5               |
| KC-10   | 擊殺 20 隻，按 5 兩次          | 第二次 Buff 啟動 2s        | 可重複消耗，剩餘 0                  |
| KC-11   | UI 顯示可用狀態                | 顯示 X/10（可用/不可用）   | 實時更新擊殺數和可用狀態            |

### 2.10.3 Quick Eat Effect on Oyster Omelet

| Test ID | Input                              | Expected Output        | Accept Criteria                        |
| ------- | ---------------------------------- | ---------------------- | -------------------------------------- |
| KC-12   | 選擇「快吃」升級                   | 蚵仔煎消耗變為 5       | UI 顯示 X/5                            |
| KC-13   | 擊殺 3 隻 + 選「快吃」+ 按 5       | 無反應                 | 消耗 10→5，3<5 不可用（3/5）           |
| KC-14   | 擊殺 7 隻 + 選「快吃」+ 按 5       | Buff 啟動 2s           | 消耗 10→5，7≥5 可用，消耗後剩餘 2      |
| KC-15   | 選「快吃」+ 擊殺 10 隻，按 5 兩次  | 第二次 Buff 啟動 2s    | 消耗 5+5，剩餘 0                       |
| KC-16   | 快吃升級後 UI 顯示                 | 顯示 X/5 而非 X/10     | 消耗需求正確更新                       |
| KC-17   | 多次選「快吃」升級                 | 消耗持續減半           | 快吃可堆疊（5→2.5→1.25...，向上取整）  |

### 2.10.4 Integration Tests

| Test ID | Input                                  | Expected Output              | Accept Criteria                  |
| ------- | -------------------------------------- | ---------------------------- | -------------------------------- |
| KC-18   | 擊殺 10 隻 + 按 5 + 按 Space           | 發射高傷害子彈               | 蚵仔煎 Buff 正確生效             |
| KC-19   | 重新開始遊戲                           | killCount = 0                | 統計重置，擊殺數歸零             |
| KC-20   | 擊殺 9 隻 + 寶箱消滅 1 隻 + 按 5       | 無反應                       | 寶箱消滅不計入，仍為 9/10        |
| KC-21   | 結束畫面顯示擊殺數                     | 顯示總擊殺數                 | 統計數據正確（含已消耗數量）     |
| KC-22   | 擊殺 15 隻 + 按 5 + 擊殺 3 隻 + 按 5   | 第二次無反應                 | 第一次消耗 10，剩 5，3<10 不可用 |

## 2.11 Game State Tests

### 2.11.1 Start Screen

| Test ID | Input | Expected Output | Accept Criteria |
| ------- | ----- | --------------- | --------------- |
| GS-01 | 遊戲啟動 | 顯示開始畫面 | 畫面顯示遊戲標題和說明 |
| GS-02 | 開始畫面 + 按 Space | 進入遊戲 | 開始畫面隱藏，遊戲開始 |
| GS-03 | 開始畫面 + 按其他鍵 | 無效果 | 開始畫面仍顯示 |
| GS-04 | 開始畫面顯示 | 遊戲未更新 | 遊戲邏輯暫停 |

### 2.11.2 Game Over Screen

| Test ID | Input | Expected Output | Accept Criteria |
| ------- | ----- | --------------- | --------------- |
| GS-05 | 玩家生命值 = 0 | 顯示結束畫面 | 畫面顯示統計資料 |
| GS-06 | 結束畫面 | 顯示存活回合數 | 統計數據正確 |
| GS-07 | 結束畫面 | 顯示擊敗敵人總數 | 統計數據正確 |
| GS-08 | 結束畫面 | 顯示使用特殊子彈次數 | 統計數據正確（現階段為 0） |
| GS-09 | 結束畫面 + 按 Space | 返回開始畫面 | 結束畫面隱藏，開始畫面顯示 |
| GS-10 | 結束畫面 + 按 Space + 再按 Space | 遊戲重新開始 | 玩家生命值恢復，回合數重置為 1 |
| GS-11 | 結束畫面顯示 | 遊戲未更新 | 遊戲邏輯暫停 |

### 2.11.3 Game Statistics Tracking

| Test ID | Input | Expected Output | Accept Criteria |
| ------- | ----- | --------------- | --------------- |
| GS-12 | 完成第 1 回合 | wavesSurvived = 1 | 統計正確記錄 |
| GS-13 | 擊敗 1 隻餓鬼 | enemiesDefeated = 1 | 統計正確記錄 |
| GS-14 | 擊敗 3 隻餓鬼 | enemiesDefeated = 3 | 統計累加正確 |
| GS-15 | 遊戲重新開始 | 所有統計歸零 | 統計重置 |

# 3. Integration Tests

## 3.1 Gameplay Loop

| Test ID | Scenario               | Steps                                                 | Expected Outcome | Accept Criteria         |
| ------- | ---------------------- | ----------------------------------------------------- | ---------------- | ----------------------- |
| IT-01   | 完整回合               | 1. 擊敗所有敵人<br>2. 拾取食材<br>3. 選擇升級         | 進入第 2 回合    | 回合數 +1               |
| IT-02   | 合成 → 射擊流程        | 1. 按 2, 2, 2 提取豆腐<br>2. 自動合成<br>3. 按 Space  | 發射 2 倍大子彈  | 臭豆腐 Buff 生效        |
| IT-03   | 升級 → 效果生效        | 1. 選擇「加辣」<br>2. 下回合合成臭豆腐<br>3. 射擊敵人 | 傷害 = ×2.5      | 升級效果永久套用        |
| IT-04   | 完整遊戲流程（5 回合） | 1. 完成 5 個回合<br>2. 面對 Boss                      | 存活至回合 5     | Boss 出現，遊戲持續運行 |

## 3.2 System Interactions

| Test ID | System A | System B | Interaction        | Expected Outcome         | Accept Criteria |
| ------- | -------- | -------- | ------------------ | ------------------------ | --------------- |
| IT-05   | 攤位系統 | 合成系統 | 提取珍珠到合成槽   | 攤位 -1，合成槽 +1       | 數據正確傳遞    |
| IT-06   | 戰鬥系統 | 合成系統 | 檢查當前 Buff 狀態 | 返回 Buff 類型和剩餘時間 | Buff 狀態正確   |
| IT-07   | 回合系統 | 升級系統 | 回合結束觸發升級   | 升級系統顯示選項         | 觸發機制正常    |
| IT-08   | 敵人系統 | 攤位系統 | 敵人請求偷取食材   | 攤位系統扣除 1 個食材    | 系統間通訊正常  |
| IT-09   | 子彈系統 | Vector   | 追蹤子彈計算方向   | 子彈正確朝向敵人移動     | Vector 運算正確 |
| IT-10   | 碰撞系統 | Vector   | 碰撞距離檢測       | 正確判斷碰撞範圍         | 距離計算正確    |
| IT-11   | 散射系統 | Vector   | 散射子彈方向生成   | 生成多個不同方向的子彈   | 向量運算正確    |

# 4. Acceptance Tests

## 4.1 User Stories

| Test ID | User Story            | Scenario                                                                               | Expected Result      | Accept Criteria          |
| ------- | --------------------- | -------------------------------------------------------------------------------------- | -------------------- | ------------------------ |
| AT-01   | 新手玩家第一次遊玩    | 1. 按 Space 射擊餓鬼<br>2. 珍珠自動進入攤位<br>3. 按 1 提取珍珠合成<br>4. 發射特殊子彈 | 特殊子彈擊中多隻敵人 | 遊戲機制直觀易懂         |
| AT-02   | 進階玩家存活 10 回合  | 1. 完成 10 個回合<br>2. 策略性使用升級和合成                                           | 玩家仍有生命值       | 第 10 回合生成 21 隻敵人 |
| AT-03   | Boss 回合使用夜市總匯 | 1. 第 5 回合開始<br>2. 合成夜市總匯<br>3. 射擊 Boss                                    | 閃電連鎖擊中所有敵人 | 夜市總匯效果正確         |

## 4.2 Game End Conditions

| Test ID | Condition      | Input                   | Expected Output        | Accept Criteria                        |
| ------- | -------------- | ----------------------- | ---------------------- | -------------------------------------- |
| AT-04   | 玩家生命值歸零 | 生命 1 + 敵人到達底線   | 遊戲暫停，顯示結算畫面 | 顯示存活回合數、擊敗敵人數             |
| AT-05   | 遊戲結束統計   | 遊戲結束畫面            | 顯示統計資訊           | 存活回合數、擊敗敵人、使用特殊子彈次數 |
| AT-06   | 重新開始       | 結算畫面 + 選擇重新開始 | 回到第 1 回合          | 所有狀態重置                           |

# 5. Performance Tests

## 5.1 Frame Rate

| Test ID | Scenario                       | Load Condition     | Expected FPS | Accept Criteria  |
| ------- | ------------------------------ | ------------------ | ------------ | ---------------- |
| PT-01   | 50 隻敵人同時存在              | 第 25 回合         | ≥ 55 FPS     | 平均幀率穩定     |
| PT-02   | 100 發子彈同時存在             | 散射類子彈大量發射 | ≥ 55 FPS     | 平均幀率穩定     |
| PT-03   | 複雜場景（50 敵人 + 100 子彈） | 極限測試           | ≥ 50 FPS     | 可接受的效能下限 |

## 5.2 Memory Usage

| Test ID | Scenario     | Duration       | Expected Memory Usage | Accept Criteria |
| ------- | ------------ | -------------- | --------------------- | --------------- |
| PT-04   | 長時間遊戲   | 30 分鐘        | 記憶體增長 < 50 MB    | 無記憶體洩漏    |
| PT-05   | 多次重新開始 | 重新開始 10 次 | 記憶體穩定            | 資源正確釋放    |

# 6. Browser Compatibility Tests

## 6.1 Cross-Browser

| Test ID | Browser | Version | Expected Result | Accept Criteria |
| ------- | ------- | ------- | --------------- | --------------- |
| BC-01   | Chrome  | 120+    | 所有功能正常    | 無錯誤，60 FPS  |
| BC-02   | Firefox | 120+    | 所有功能正常    | 無錯誤，60 FPS  |
| BC-03   | Safari  | 17+     | 所有功能正常    | 無錯誤，60 FPS  |
| BC-04   | Edge    | 120+    | 所有功能正常    | 無錯誤，60 FPS  |

# 7. Manual Testing Checklist

## 7.1 Visual Quality

- [ ] 攤位區域正確顯示在左側 20%
- [ ] HUD 不遮蓋遊戲活動區域
- [ ] 敵人生成和移動動畫流暢
- [ ] 子彈發射方向正確（向右）
- [ ] 食材掉落位置合理（敵人死亡處）
- [ ] 特殊子彈效果可視化清晰
- [ ] Pixi.js Sprite 渲染正確
- [ ] 碰撞箱大小視覺化準確

## 7.2 Audio Quality

- [ ] 射擊音效正確觸發
- [ ] 敵人死亡音效播放
- [ ] 合成成功音效提示
- [ ] 背景音樂循環播放
- [ ] Boss 出現特殊音效

## 7.3 User Experience

- [ ] 鍵盤操作反應靈敏（延遲 < 100ms）
- [ ] 合成槽視覺回饋清晰
- [ ] 升級選項說明易懂
- [ ] 遊戲結束畫面統計準確
- [ ] 重新開始功能正常
- [ ] 載入時間 < 3 秒

# 8. Continuous Integration

## 8.1 CI Pipeline

1. **Lint**：程式碼風格檢查（Prettier + ESLint）
2. **Type Check**：TypeScript 型別檢查
3. **Unit Tests**：單元測試（Vitest）
4. **Integration Tests**：整合測試
5. **Build**：編譯打包（Vite）
6. **Deploy Preview**：部署預覽環境（Cloudflare Pages）

## 8.2 Quality Gates

| Gate            | Requirement | Accept Criteria  |
| --------------- | ----------- | ---------------- |
| 測試通過率      | 100%        | 所有測試必須通過 |
| 程式碼覆蓋率    | ≥ 80%       | 總體覆蓋率達標   |
| TypeScript 錯誤 | 0           | 無型別錯誤       |
| Lint 錯誤       | 0           | 無程式碼風格錯誤 |
| 建置成功        | ✓           | 建置無錯誤       |
